webpackJsonp([39],{0:function(n,e,t){"use strict";var o=(t(4),t(44),t(1)),r=t(5),a=t(3),i=(t(8),t(13),t(11));o.prepare({requireLogin:!1,regEvents:{onSceneReturn:function(n){n=n||{},n.url&&r.reload(n.url)}}},function(){var n=(o.getParameter("offset"),parseInt(o.getParameter("rank_type")||"-1"));r.replaceURL(o.buildURL({rank_type:null}));var e=[{name:"大家都在买"},{name:"最新"},{name:"猜你喜欢"}],u=["v2/ranklist","v2/newlist","v2/randlist"];o.changeTitle("排行榜");var s=localStorage.getItem("LAST_RANK_INDEX")||0;n>=0&&(s=n);var l=function(n,e){o.apiRequest("GET",u[n],null,function(n){var t=n;c(t,e)},function(){a.hide()})},c=function(n,e){t(61)(function(t){t.load(n,function(n){n&&t.show(f.goodsListReady(e))},{id:"goods_list_"+f.currentRankType,notRecordScroll:2==f.currentRankType})},function(){}),i.hasNewMsg(),avalon.scan(document.getElementById("index-content")),n.length<=0&&a.hide()},f=avalon.define({$id:"rank",show:"hidden",currentRankType:s,rankData:{rankVisible:!0},rankTypes:e,setCurrentRankType:function(n){f.currentRankType=n,localStorage.setItem("LAST_RANK_INDEX",f.currentRankType)},goodsListReady:function(n){a.hide(),f.show="visible"},reloadGoodsByRank:function(n){a.show(),f.show="hidden",f.setCurrentRankType(n),l(n,!0)}});t(12)(function(){}),l(s),f.setCurrentRankType(s)})},11:function(n,e,t){var o=t(1),r=t(6),a=t(8);t(10);n.exports=function(){var n=3e4,e=1,t={Open:0,Close:1,Authentication:2,Message:3},i=null,u=0,s={},l={},c=[],f=0,d=!1,p=void 0!==window.WebSocket,g=function(){return null!=i&&i.readyState==WebSocket.OPEN},v=function(){g()||null!=i&&i.readyState==WebSocket.CONNECTING||!p||(i=new WebSocket(r.pushDomain+"?"+o.buildQuery({access_token:a.getAccessToken(),role:"user"})),i.onopen=function(){setTimeout(function(){y(),k(t.Open)},50)},i.onclose=function(){setTimeout(function(){d=!1,k(t.Close)},50)},i.onerror=function(n){},i.onmessage=function(n){if(null!=n&&null!=n.data){var e=JSON.parse(n.data);if(null!=e){var o=e.response,r="ok"===e.result;if(!r&&null!=e.result,"auth"==o)return r&&(d=!0),k(t.Authentication,r);var a=e.request_id;if(null!=a){var i=l[a];null!=i&&setTimeout(function(){i(e)},50)}k(t.Message,e)}}})},h=function(n,e){if(null==e)return null;var t=u++;return s[t]={type:n,handler:e},t},k=function(n){for(var e=[],t=1;t<arguments.length;++t)e.push(arguments[t]);for(var o in s){var r=s[o];r.type==n&&setTimeout(function(){r.handler.apply(null,e)},50)}},y=function(n){if(p){var t=null;return"object"==typeof n&&(t=e++,n.request_id=t,c.push(n)),g()?(c.forEach(function(n){i.send(JSON.stringify(n))}),c=[]):v(),t}};return{isOpen:g,isSupport:p,hasAuthenticated:function(){return p?d:!1},onOpen:function(n){return h(t.Open,n)},onClose:function(n){return h(t.Close,n)},onAuthenticationResult:function(n){return p?h(t.Authentication,n):void 0},onMessage:function(n){return p?h(t.Message,n):void 0},unregister:function(n){delete s[n]},keepAlive:function(){if(p)if(g()){var e=Date.now();e-f>=n&&(y({cmd:"heartbeat"}),f=e)}else v()},send:function(n){p&&y(n)},request:function(n,e){if(p){var t=y(n);return null==t||null==e?t:void(l[t]=e)}},hasNewMsg:function(n,e){if(p&&a.hasAccessToken()){var t=JSON.parse(localStorage.getItem("LastPersonalMsg"))||{},r=t.key||0,i=t.time||0;if(0==r||n){var u=Date.now().toString(),s={key:r,time:i};if(3e4>u-i&&!n)return s.time=u,void localStorage.setItem("LastPersonalMsg",JSON.stringify(s));var c=0,f=y({cmd:"latest_conversations",page:1,size:20});l[f]=function(n){for(var t=n.conversations,r=document.querySelector("#footer_personal i"),a=0;a<t.length;a++)"read"!=t[a].status&&c++;null!=r&&0!=c&&r.classList.add("fb-badge1"),s.key=c,s.time=u,localStorage.setItem("LastPersonalMsg",JSON.stringify(s)),null!=e&&o.call(e,c)}}}},alertNotSupport:function(n){p||o.showAlert("您的系统版本不支持这个功能(Android系统版本至少为4.3)",function(){o.call(n)})}}}()},12:function(n,e,t){t(2),n.exports=function(n,e){t.e(6,function(o){o?e():n(t(15))})}},61:function(n,e,t){t(2),n.exports=function(n,e){t.e(22,function(o){o?e():n(t(313))})}}});