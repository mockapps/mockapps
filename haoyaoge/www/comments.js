webpackJsonp([81],[function(t,e,n){var o=n(1),r=n(5),a=n(3),s=n(7),i=n(4),c=n(18);o.prepare({requireLogin:!0},function(){var t=o.getParameter("order_sn"),e=o.getParameter("thumb_url"),n=o.getParameter("goods_id"),d=o.getParameter("type")||s.OrderType.All,m=null,u=function(){g(),a.hide()},g=function(){if(!m){m=avalon.define({$id:"comment",thumbUrl:e,stars:0,commentContent:"",submitComments:function(){if(m.stars<=0)return void c.show("您还没有选择星级评分",{showDuration:500,center:!0});if(m.commentContent.length>500)return void o.showToast("评论应在500字以内");var e={goods_id:n,order_sn:t,score:m.stars,comment:m.commentContent.trim()};o.apiRequest("POST","order/goods/review",e,function(e){if(e.rating_id&&parseInt(e.rating_id)>0){if(o.showToast("感谢您的评价！"),localStorage.getItem("ORDER_INFO_CACHES")){for(var n=JSON.parse(localStorage.getItem("ORDER_INFO_CACHES")),a=0;a<n.length;a++)n[a].order_sn==t&&(n[a].shipping_status=s.ShipmentStatus.Received,n[a].rate_status=s.rateStatus.rateUnable,n[a].order_combined_status=s.OrderCombinedStatus.Received,n[a].order_status_desc=s.OrderDesc.Received,d==s.OrderType.Evaluating&&n.splice(a,1));localStorage.setItem("ORDER_INFO_CACHES",JSON.stringify(n))}setTimeout(function(){r.back()},1e3)}else o.showToast("评价失败")},function(){})}}),avalon.scan();var a=i(window).width()>640?640:i(window).width(),u=a-30;i(".comment_content").css("width",u),i(".comment_star_background").each(function(t){i(this).bind("touchstart",function(){for(var e=0;t+1>e;e++)document.getElementsByClassName("comment_star_background")[e].style.backgroundPosition="-30px";for(var e=t+1;5>e;e++)document.getElementsByClassName("comment_star_background")[e].style.backgroundPosition="0";m.stars=t+1})})}};u()})}]);