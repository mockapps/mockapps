webpackJsonp([42],{0:function(e,r,n){"use strict";n(36);var o=n(4),t=n(1),a=n(5),s=n(3),i=n(7),d=n(24);t.prepare({requireLogin:!0},function(){var e="确定取消订单？",r="是否确认收货？",l="您还没有任何相关订单哦",u="您已经没有更多的订单了",c="亲，确认延长收货订单？(每笔订单只能延长一次哦~)",p="亲，您已经延长过收货时间哦~",_="亲，距离结束时间3天才可以申请哦~",f="延长收货成功!",m="延长收货失败!",g="已确认，待抽奖",h=10,y="order_combined_status",v="order_status_desc",E={All:0,PendingPay:1,Shipping:2,Collecting:3},b=["all","unpaid","unshipping","unreceived","lucky"],O=new Date("2015/11/05 00:00:00").getTime(),S=t.getParameter("type"),T=null,I=null,C=[],w=[],R=[],U=function(){null==I&&(I=avalon.define({$id:"root",isLoading:!1,orderType:null==S?E.All:parseInt(S,10),orders:[],message:null,noOrderAtAll:!1,userInteractionEnabled:!0,switchList:function(e){if(I.userInteractionEnabled&&e!=I.orderType){a.replaceURL(t.buildURL({type:e})),I.isLoading=w[e],I.orderType=e,I.orders=[],I.message=null;var r=C[e];console.log(C[e]),null==r?x(e):I.orders=JSON.parse(JSON.stringify(r))}},showOrderDetails:function(e){t.saveToLocalStorage("ORDER_INFO_CACHES",JSON.stringify(C[I.orderType]));var r={type:I.orderType,sp:document.getElementsByTagName("body")[0].scrollTop},n=t.buildURL(r);a.replaceURL(n,function(){a.forward("order.html?order_sn="+e)})},payOrder:function(e){if(I.userInteractionEnabled){var r=e.order_sn,n=e.order_goods[0].goods_name;t.isWeChatPlatform()?(I.setUserInteractionEnabled_(!1),payment.pay(i.PaymentType.WeChat,r,n,function(e){I.setUserInteractionEnabled_(!0)},!0)):I.showOrderDetails(r)}},cancelOrder:function(r){if(I.userInteractionEnabled){I.setUserInteractionEnabled_(!1);var n=function(){var e=r.order_sn;t.apiRequest("POST","order/"+e+"/cancel",null,function(){I.setUserInteractionEnabled_(!0),I.markOrderCancelled_(r)},function(){I.setUserInteractionEnabled_(!0)})};t.showConfirm(e,n,function(){I.setUserInteractionEnabled_(!0)})}},showExpress:function(e){if(I.userInteractionEnabled){I.setUserInteractionEnabled_(!1);var r=e.order_sn;n(21)(function(e){I.setUserInteractionEnabled_(!0),e.load(r),e.show()},function(){I.setUserInteractionEnabled_(!0),t.showToast(Error.messageFromCode(0))})}},extendReception:function(e){var r=function(){return e.can_extend_receive.hasExtended?void t.showToast(p):e.can_extend_receive.time?void t.apiRequest("POST","order/"+e.order_sn+"/extention",null,function(r){e.can_extend_receive.hasExtended=!0,t.showToast(f)},function(){t.showToast(m)}):void t.showToast(_)};t.showConfirm(c,r,function(){})},confirmShipment:function(e){if(I.userInteractionEnabled){I.setUserInteractionEnabled_(!1);var n=function(){var r=e.order_sn;t.apiRequest("POST","order/"+r+"/received",null,function(r){if(I.setUserInteractionEnabled_(!0),I.markOrderReceived_(e),t.isNativePlatform()){var n=r.share_code||"";if(n.length>0){t.saveToLocalStorage("ORDER_INFO_CACHES",JSON.stringify(C[I.orderType]));var o={type:I.orderType,sp:document.getElementsByTagName("body")[0].scrollTop},s=t.buildURL(o);a.replaceURL(s,function(){a.forward("coupon_send.html?"+t.buildQuery({coupon_code:n}))})}}},function(){I.setUserInteractionEnabled_(!0)})};t.showConfirm(r,n,function(){I.setUserInteractionEnabled_(!0)})}},showMessage:function(){R[I.orderType]&&(I.orders.length<=0?(I.message=l,I.noOrderAtAll=!0):I.orders.length>=h&&(I.message=u))},markOrderCancelled_:function(e){var r=e.order_sn,n=i.OrderCombinedStatus.Cancelled;I.markCacheOrderStatus_(r,n),[E.PendingPay,E.Shipping].forEach(function(e){var r=C[e];if(null!=r)for(var o=r.length-1;o>=0;--o)r[o][y]==n&&r.splice(o,1)}),I.orders=C[I.orderType]},markOrderReceived_:function(e){var r=e.order_sn,n=i.OrderCombinedStatus.Received;I.markCacheOrderStatus_(r,n);var o=C[E.Shipping];if(null!=o)for(var t=o.length-1;t>=0;--t)o[t][y]==n&&o.splice(t,1);I.orders=C[I.orderType]},markCacheOrderStatus_:function(e,r){var n=d.getOrderCombinedStatusDescription(r);C.forEach(function(o){o.forEach(function(o){o.order_sn==e&&(o[y]=r,o[v]=n)})})},removeOrderAtIndex_:function(e){I.orders.removeAt(e);var r=C[I.orderType];null!=r&&e>=0&&e<r.length&&r.splice(e,1)},setUserInteractionEnabled_:function(e){I.userInteractionEnabled=e,e?s.hide():s.show()}}),I.$watch("orders",function(){I.showMessage()}),avalon.scan(document.body),x(I.orderType))},x=function(e){if(!w[e]&&!R[e]){if(null==C[e]&&(C[e]=[]),w[e]=!0,e==I.orderType&&(I.isLoading=!0,I.message=null),null==T&&(T={sp:t.getParameter("sp")||null}),null!=T.sp)return C[e]=JSON.parse(localStorage.getItem("ORDER_INFO_CACHES")),localStorage.removeItem("ORDER_INFO_CACHES"),C&&(e==I.orderType&&I.orders.pushArray(C[e]),document.getElementsByTagName("body")[0].scrollTop=T.sp,w[e]=!1,R[e]=C[e].length%10!=0,e==I.orderType&&(I.isLoading=w[e],I.showMessage())),T.sp=null,void a.replaceURL(t.buildURL({sp:null}));localStorage.getItem("ORDER_INFO_CACHES")&&localStorage.removeItem("ORDER_INFO_CACHES");var r=C[e].length,n=Math.floor(r/h)+1,o=function(r){w[e]=!1,R[e]=h>r,e==I.orderType&&(I.isLoading=w[e])};t.apiRequest("GET","ordersv2/"+b[4]+"?"+t.buildQuery({page:n,size:h}),null,function(n){var t=n.orders||[],a=n.timestamp||Date.parse(new Date);o(t.length),t.forEach(function(e){var r=e.order_status,n=e.pay_status,o=e.shipping_status,t=d.getOrderCombinedStatus(r,n,o);e[y]=t,e[v]=d.getOrderCombinedStatusDescription(t);var s=null,l=e.order_goods;if(null!=l&&l.length>0&&(s=l[0]),null!=s){var u=s.lucky_draw,c=e.lucky_draw_result;e.used_coupons=parseInt(s.goods_price)*parseInt(s.goods_number||"1")>parseInt(e.order_amount),e.order_amount=(e.order_amount/100).toFixed(2),e.goods_price=(s.goods_price/100).toFixed(2),e.spec=s.spec||"",e.goods_number=s.goods_number||"1",e.coupons=e.coupons||[],e.order_time=e.order_time||0,e.show=1e3*e.order_time-O>0,null!=u?(e.lucky_status=u.status,e.lucky_status<3&&t==i.OrderCombinedStatus.Confirmed&&(e[v]=g)):e.lucky_status=null,null!=c?e.lucky_result=c.status||"":e.lucky_result=null,t==i.OrderCombinedStatus.Unconfirmed&&0==e.order_amount&&a-e.order_time>=86400&&(e[v]=d.getOrderCombinedStatusDescription(i.OrderCombinedStatus.Expired)),t==i.OrderCombinedStatus.Shipping&&(e.can_extend_receive=function(){var r=parseInt(e.shipping_time)+1036800,n=r+259200,o=e.order_extention||{},t=o.extention_time||"0";return{time:a>r&&n>a,hasExtended:"0"!=t}}())}}),r==C[e].length&&(C[e].push.apply(C[e],t),e==I.orderType&&(I.orders.pushArray(JSON.parse(JSON.stringify(t))),I.showMessage()))},function(){o(!1)})}},L=function(){o(document).scroll(function(){null!=I&&o(document).scrollTop()+o(window).height()>=o(document).height()&&x(I.orderType)})};n(14)(function(e){window.payment=e,U(),s.hide(),L()},function(){location.reload()})})},14:function(e,r,n){n(2),e.exports=function(e,r){n.e(7,function(o){o?r():e(n(23))})}},21:function(e,r,n){n(2),e.exports=function(e,r){n.e(11,function(o){o?r():e(n(43))})}},36:function(e,r){}});