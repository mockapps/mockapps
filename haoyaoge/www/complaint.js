webpackJsonp([65],{0:function(e,i,t){"use strict";t(34);var o=t(4),a=t(1),n=t(3),r=(t(25),t(5)),s=(t(10),o(document.body).height());a.prepare({requireLogin:!0},function(){var e="请填写问题描述",i="问题分类不能为空",t="问题描述最少写10个字",c="提交申请",l="正在提交...",m="提交成功",u="提交失败，请重试",d="第{0}张图片上传失败，请尝试重新提交",g="图片上传失败，请重试",f="请选择jpeg、png格式的图片",h=10,p=a.getParameter("order_sn"),v=null,b=function(s){if(null!=s&&null==v){v=avalon.define({$id:"root",isRefund:!1,hideProblemDesc:!0,submitHint:c,orderAmount:(s.order_amount/100).toFixed(2),orderSN:s.order_sn||"",goodsName:"",problemDesc:"",goodsThumbnailURL:"",certificateImages:[],showUploadIcon:!0,imageUrls:[],uploadImage:function(e){var i=o.Deferred(),t={image_batch:e};return a.apiRequest("POST","batch_image",t,function(e){for(var t=0;t<v.certificateImages.length;t++){if(void 0==e[t].url)return a.showToast(a.format(d,t+1)),n.hide(),void(v.submitHint=c);v.imageUrls.push(e[t].url)}i.resolve()},function(){a.showToast(g),n.hide(),v.submitHint=c}),i.promise()},confirmComplaint:function(){var s=o(".complain-problem-type").val();if(""==s)return void a.showToast(i);var d=v.problemDesc.trim();if(0==d.length)return void a.showToast(e);if(d.length<h)return void a.showToast(t);v.imageUrls.splice(0,v.imageUrls.length),v.submitHint=l,n.show();for(var g=[],f=0;f<v.certificateImages.length;f++)g.push(v.certificateImages[f].sourceUrl);var p=o.Deferred();p=v.uploadImage(g),o.when(p).done(function(){var e={type:s,detail:d,images:v.imageUrls,is_refund:v.isRefund};a.apiRequest("POST","order/"+v.orderSN+"/complain",e,function(e){n.hide(),v.submitHint=m,a.showToast(m),setTimeout(function(){r.back("order.html?order_sn="+v.orderSN)},500)},function(){a.showToast(u),n.hide(),v.submitHint=c})}).fail(function(){a.showToast(u),n.hide(),v.submitHint=c})},deleteUploadImage:function(e){event.stopPropagation();for(var i=0;i<v.certificateImages.length;i++)if(v.certificateImages[i].sourceUrl==e){v.certificateImages.splice(i,1),v.showUploadIcon=v.certificateImages.length<3;break}},changeRefundValue:function(){v.isRefund=!v.isRefund},changeProblemDescHideStatus:function(){v.hideProblemDesc=!v.hideProblemDesc,v.hideProblemDesc||document.getElementById("complaint_desc_text").focus()},viewImage:function(e){for(var i=navigator.userAgent||navigator.vendor||window.opera,t=[],o=0;o<v.certificateImages.length;o++)t.push(v.certificateImages[o].sourceUrl);a.viewImages(e,t,{ViewNotWechatInteraface:null!=i.match(/Android/i)})},imageSelect:function(){a.isNativePlatform()&&(o("#complaint_desc_text").blur(),a.selectImageInNative(function(e){w(e)}))}}),a.isNativePlatform()&&o(".upload-select-img").remove();var p=s.order_goods||[],b=p.length>0?p[0]:null;null!=b&&(v.goodsName=b.goods_name||"",v.goodsThumbnailURL=b.thumb_url||""),o(".upload-select-img").change(function(){var e=this.files[0],i=/^(image\/jpeg|image\/png)$/i;return i.test(e.type)?void(a.isNativePlatform()||w(e)):void a.showToast(f)}),avalon.scan(document.body)}},w=function(e){var i;if(a.isNativePlatform())i=e;else{var t=t||webkitURL;i=t.createObjectURL(e)}var n=Math.floor(o("#certificate_img").width()/5-4),r={sourceUrl:"",loading:!0};v.certificateImages.push(r);for(var s=n+"px",c=0;c<v.certificateImages.length;c++)o(".upload-img-unit").eq(c).css({"max-width":s,"max-height":s});v.showUploadIcon=v.certificateImages.length<3,a.compressImage(i,function(e){v.certificateImages[v.certificateImages.length-1].sourceUrl=e,v.certificateImages[v.certificateImages.length-1].loading=!1})},I=function(){null!=v&&(o("#complaint_desc_text").blur(function(){0==v.problemDesc.trim().length&&(v.problemDesc="",v.hideProblemDesc=!0)}),o(window).resize(function(){o(document.body).height()==s&&0==v.problemDesc.trim().length&&(v.problemDesc="",v.hideProblemDesc=!0)}))},_=function(){var e=o("#certificate_img").width()/5,i=e/7,t=e+20,r=e/4;e+="px",i+="px",r+="px",o(".upload-img").css({height:e,width:e,"font-size":i}),o(".upload-img-view").css({height:e,width:e}),o("#certificate_img").css({height:t}),o(".delete-img").css({width:r,height:r,"line-height":r}),a.apiRequest("GET","order/"+p,null,function(e){n.hide(),b(e),n.hide(),I()},function(){setTimeout(function(){location.reload()},1e3)})};_()})},34:function(e,i){}});