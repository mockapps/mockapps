webpackJsonp([22],{313:function(o,t,s){var i=s(4),n=s(1),e=s(7),a=s(5),l=s(8);o.exports=function(){"use strict";var o=s(342),t={HIDE:{bottom:-parseInt(.25*i(window).height())+"px",opacity:"0.0"},SHOW:{bottom:"64px",opacity:"1.0"}},r={},d={},c=null,g={},u={},m="goods_list",p=m,h={SHOW:"pullUp_show",HIDE:"pullUp_hide"},v={DEFAULT:"正在玩命的加载...",NO_MORE_GOODS:"没有更多的商品了..."},f={ON:"loading-spin",OFF:"loading-stop"},_=100,L=function(){var o=i(window).height()/i(window).width();return 1>o?1/o:o},w="",D=i(window).width();D>390?(D=46,w="rank_high"):360>D?(D=36,w="rank_small"):D=43;var I=Math.floor(5*L()),O=11,k=3,b=1,T=!1,y={},x=null,S={},R=[],C=!0,E=function(){null==y[p]&&(y[p]=avalon.define({$id:p,visible:!1,goodsList:[],currentList:[],topButtonBottom:t.HIDE.bottom,topButtonOpacity:t.HIDE.opacity,imgWidth:""+D+"%",loadingClass:h.SHOW,loadingTxt:v.DEFAULT,loadingRotateClass:f.ON,waitForGoodsLoading:!1,goTopClass:"go_top_"+p,shortenDoing:!1,imgLoadingClass:"imgLoading_"+p,isReady:!1,rankStyle:w,currentPage:p,show:function(){y[p].visible=!0,P()},hide:function(){y[p].visible=!1},goodsListReady:function(){y[p].isReady||(y[p].isReady=!0,n.call(c,!0),c=null)},selectGoods:function(o){if(o){var t=u.notRecordScroll?{}:{sp:i(document).scrollTop().toString(),goods_id:o},s=n.buildURL(t);a.replaceURL(s,function(){var t="goods.html?goods_id="+o;u.mallID&&(t+="&mall_id="+u.mallID),a.forward(t)})}n.call(u.selectGoods)},isSoldOut:function(o){return o!=e.SkuStatus.OnSale},showGoodsLoading:function(){var o=y[p].currentList.length;o<y[p].goodsList.length&&!y[p].waitForGoodsLoading?(y[p].loadingClass=h.SHOW,y[p].waitForGoodsLoading=!0,y[p].loadingTxt=v.DEFAULT,y[p].loadingRotateClass=f.ON,setTimeout(function(){y[p].loadingRotateClass=f.OFF,y[p].waitForGoodsLoading=!1,y[p].currentList=y[p].currentList.concat(y[p].goodsList.slice(o,O+o)),i("."+y[p].imgLoadingClass).scrollLoadList({attr:"data-url"})},_)):o>=y[p].goodsList.length&&(y[p].loadingClass=h.HIDE,y[p].loadingTxt=v.NO_MORE_GOODS,y[p].loadingRotateClass=f.OFF)},shortenList:function(){y[p].currentList.length<=I||(y[p].currentList=y[p].goodsList.slice(0,I))},goodsLike:function(o){if(event.stopPropagation(),l.hasAccessToken()){if(!C)return;o.islike?(C=!1,n.apiRequest("POST","unlike/"+o.goodsID,o.goodsID,function(t){S.time=t,o.islike=!1,R.splice(R.indexOf(o.goodsID),1),S.id=R,localStorage.setItem("LIKEDATA",JSON.stringify(S)),n.showToast("取消成功"),C=!0},null)):(C=!1,n.apiRequest("POST","like/"+o.goodsID,o.goodsID,function(t){S.time=t,o.islike=!0,R.push(o.goodsID),console.log(R),S.id=R,localStorage.setItem("LIKEDATA",JSON.stringify(S)),n.showToast("收藏成功"),C=!0},null))}else a.reload("login.html?from=goods_id"+o.goodsID)}}))},F=function(o){if(null!=y[p]){for(var t=[],s=(n.isNativePlatform(),function(o){o=Math.round((new Date).getTime()/1e3)-o;var t=o%60,s=Math.floor(o/60),i=Math.floor(s/60),n=Math.floor(i/24);return n>0?n+"天":i>0?i+"小时":s>0?s+"分钟":t+"秒"}),i=0;i<o.length;i++){var a=o[i];a.goods_id==x.goodsID&&(x.itemIndex=i);var l=R.indexOf(a.goods_id)<0?!1:!0,r=a.hd_thumb_url||a.thumb_url;t.push({goodsID:a.goods_id,imgUrl:n.upaiyunCompress(r),goodsName:a.goods_name,salePrice:(a.group.price/100).toFixed(2),status:e.SkuStatus.OnSale,eventDesc:a.group.customer_num+"人团",volume:a.cnt,recent:s(a.time),islike:l})}y[p].goodsList=t;var d=I;!B()&&x.currentID==p&&x.itemIndex>=0&&(d=x.itemIndex+O),y[p].currentList=y[p].goodsList.slice(0,d),y[p].goodsList.length<=I&&(y[p].loadingClass=h.HIDE,y[p].loadingTxt=v.NO_MORE_GOODS,y[p].loadingRotateClass=f.OFF)}},B=function(){var o=x.sp-i(window).height();return o<=i(document).scrollTop()},N=function(o){F(o),0==o.length&&y[p].goodsListReady()},H=function(t,s,i){var e=t.goods_list;t.favorite_update_time;u=i||{},p=u.id||m,null==x&&(x={currentID:p,sp:parseFloat(n.getParameter("sp")||0),itemIndex:-1,goodsID:n.getParameter("goods_id")}),T=u.isIndex||!1,T||(I=O),null==r[p]&&(r[p]=n.createNodeFromHTML(n.format(o,p))),c=s,g.goodsList=e,E(),N(e),d[p]?n.call(c,!0):(d[p]=!0,document.getElementById(p).appendChild(r[p]),avalon.scan(r[p]))},G=function(){var o=2*i(window).height();for(var s in y)y[s].topButtonBottom=t.HIDE.bottom,y[s].topButtonOpacity=t.HIDE.opacity;i(window).scrollTop()>=o&&(y[p].topButtonBottom=t.SHOW.bottom,y[p].topButtonOpacity=t.SHOW.opacity)},P=function(){var o=i(".go-top");o.unbind("click"),o.click(function(){event&&event.preventDefault(),document.getElementsByTagName("body")[0].scrollTop=0}),i("."+y[p].imgLoadingClass).scrollLoadList({attr:"data-url"})},U={};i.fn.scrollLoadList=function(o){U[p]||(U[p]=0),U[p]++;var t={attr:"data-url"},s=i.extend({},t,o||{});s.cache=[],s.cnt=U[p],i(this).each(function(){var o=this.nodeName.toLowerCase(),t=i(this).attr(s.attr);if(t&&!(i(this).offset().top<=0)){var n={obj:i(this),tag:o,url:t,showed:!1};s.cache.push(n)}});var n=function(){if(s.cnt==U[p]){var o=i(window).scrollTop()-i(window).height();0>=o&&x.itemIndex<I&&y[p].shortenList();var t=o+2*i(window).height(),n=-1;return i.each(s.cache,function(s,i){var e=i.obj,a=i.tag,l=i.url,r=i.showed,d=e.offset().top,c=d+e.height();(d>o&&t>d||c>o&&t>c)&&s<y[p].currentList.length&&(e&&!r&&("img"===a?e.attr("src",l):e.load(l),i.showed=!0),n=s)}),o>0&&(n+k>=y[p].currentList.length||i(document).height()+b<=i(document).scrollTop()+i(window).height())&&y[p].showGoodsLoading(),!1}};i(window).unbind("scroll"),i(window).bind("scroll",function(){n(),G()}),n()};var M=function(o){null!=y[p]&&y[p].show(),null!=x&&(x.sp>0&&x.currentID==p?(document.getElementsByTagName("body")[0].scrollTop=x.sp,x.sp=0,x.itemIndex=-1):document.getElementsByTagName("body")[0].scrollTop=0,a.replaceURL(n.buildURL({sp:null,goods_id:null}))),setTimeout(function(){n.call(o)},100)},A=function(){null!=y[p]&&y[p].hide()};return{load:H,show:M,hide:A}}()},342:function(o,t){o.exports='<div ms-controller="{0}">\r\n<div class="goods-list-wrapper" ms-visible="visible">\r\n    <div ms-repeat-item="currentList" ms-click="selectGoods(item.goodsID)" data-repeat-rendered="goodsListReady"> \r\n        <div class="rank_g" ms-class="{{rankStyle}}">\r\n            <div class="rank_g_index">{{$index+1}}</div>\r\n            <div class="rank_g_img">\r\n                <img src="http://pinduoduo.b0.upaiyun.com/test/default_square.jpg"  ms-data-url="item.imgUrl" ms-class="{{imgLoadingClass}}">\r\n               <!--  <div class="like rank_list_like" ms-class-liked="item.islike" ms-click="goodsLike(item)"></div> -->\r\n            </div>\r\n            <div class="rank_g_info">\r\n                <p class="rank_g_name" ms-text="item.goodsName"></p>\r\n            </div>\r\n            <div class="rank_core">\r\n                <div class="rank_g_volume" ms-if="currentPage==\'goods_list_0\'">\r\n                    已售 <b>{{item.volume}}</b> 件\r\n                </div>\r\n                <div class="rank_g_recent" ms-if="currentPage==\'goods_list_1\'">\r\n                    <b>{{item.recent}}前</b>\r\n                </div>\r\n                <div class="rank_g_core">\r\n                    <div class="rank_g_price" ms-css-width="imgWidth">\r\n                        <span ms-text="item.eventDesc"></span>\r\n                        <b ms-class="price-small:item.salePrice.length>5"><span>¥ </span>{{item.salePrice}}</b>\r\n                    </div>\r\n                    <div class="rank_g_btn">{{item.goodsID == 884 ? "查看详情" : "去开团"}}</div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div id="load_more" ms-class="{{loadingClass}}">\r\n        <div class="center" ms-if="loadingClass==\'pullUp_show\'">\r\n            <span>\r\n                <img ms-class="img_rotate {{loadingRotateClass}}" src="assets/img/pull_loading-1e493b5612.png"/>\r\n            </span>\r\n            <span class="orders_text" ms-text="loadingTxt"></span>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="go-top" ms-class="{{goTopClass}}" ms-css-bottom="topButtonBottom" ms-css-opacity="topButtonOpacity"><span>顶部</span></div>\r\n</div>\r\n'}});