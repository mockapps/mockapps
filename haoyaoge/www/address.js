webpackJsonp([84],[function(e,i,t){"use strict";var r=(t(4),t(8)),n=t(1),d=t(3),a=t(7),s=t(6),o=t(26),l=t(5);n.prepare({requireLogin:!0,disableFastClick:!0},function(){var e="确定删除这个地址吗？",i="Regions",t=null,c=15,u=n.format("收货人的名字长度不能超过{0}个字符",c),v=n.getParameter("address_id"),f=n.getParameter("uid"),g=n.getParameter("goods_id"),m=n.getParameter("sku_id"),p=navigator.userAgent.match(/MicroMessenger\/([\d\.]+)/i),_=function(){var e=n.getParameter("allowed_regions");return null==e?[]:e.split(",")}(),I=null,D=!0,y=function(){r.logout(function(){l.reload()})},b=function(){return D?null:(null==t&&(t=localStorage.getItem(i),null!=t&&(t=JSON.parse(t))),null!=t?t.regions:(t={regions:{}},t.regions))},h=function(e,r){if(D||null==r)return void S();var n=t.regions[e];null==n||void 0==n?t.regions[e]=r:r.forEach(function(i){t.regions[e].push(i)});var d=JSON.stringify(t);localStorage.setItem(i,d)},S=function(){t=null,localStorage.removeItem(i)},E=function(e){return D?n.call(e):(b(),void n.call(e))},R=function(e,i,t){if(!D){var r=b(),d=!1;if(null!=r&&null!=r[e]){var a=[];if(r=r[e],r.forEach(function(e){e.parent_id==i&&(a.push(e),d=!0)}),d)return n.call(t,a)}}n.apiRequest("GET","regions/"+i,null,function(i){h(e,i),n.call(t,i)},null)},A=function(e,i){if(null==i)return!1;for(var t=0;t<i.length;++t){var r=i[t];if(r.region_id==e)return!0}return!1},P=function(e,i){_.length>0&&""!=n.getParameter("allowed_regions")&&(i=i.filter(function(e){return _.indexOf(e.region_id)>=0})),I.provinces=i||[],A(e,i)?I.provinceID=e||"0":(I.provinceID="0",I.cityID="0",I.districtID="0"),I.provincesLoaded=!0},C=function(e,i){I.cities=i||[],A(e,i)?I.cityID=e||"0":(I.cityID="0",I.districtID="0"),I.citiesLoaded=!0},T=function(e,i){I.districts=i||[],A(e,i)?I.districtID=e||"0":I.districtID="0",I.districtsLoaded=!0,d.hide(),I.show="visible"},w=function(e){if(null!=e){var i=e.region_id||a.Region.China,t=e.province_id,r=e.city_id,n=e.district_id;R(a.RegionType.Province,i,function(e){P(t,e),null!=t&&t==I.provinceID&&R(a.RegionType.City,t,function(e){t==I.provinceID&&(C(r,e),null!=r&&r==I.cityID&&R(a.RegionType.District,r,function(e){r==I.cityID&&T(n,e)}))})}),I.receiver=e.name||"",I.mobile=e.mobile||"",I.address=e.address||"",I.is_default=e.is_default||a.AddressClass.Common,I.loaded=!0}},L=function(){I=avalon.define({$id:"root",loaded:!1,enabled:!0,isEdit:null!=v,provincesLoaded:!1,citiesLoaded:!1,districtsLoaded:!1,provinces:[],cities:[],districts:[],receiver:"",mobile:"",provinceID:"0",cityID:"0",districtID:"0",address:"",is_default:"0",isReceiverValid:!0,isMobileValid:!0,isProvinceIDValid:!0,isCityIDValid:!0,isDistrictIDValid:!0,isAddressValid:!0,show:"hidden",showLoadWeixinAddress:n.isWeChatPlatform()&&null==v&&p&&p[1]>="5.0",onReceiverEdited:function(){I.loaded&&I.validateReceiver()},onMobileEdited:function(){I.loaded&&I.validateMobile()},onProvinceEdited:function(){if(I.provincesLoaded&&(C("0",[]),T("0",[]),I.validateProvince())){var e=I.provinceID;R(a.RegionType.City,e,function(i){e==I.provinceID&&C(I.cityID,i)})}},onCityEdited:function(){if(!I.citiesLoaded)return!1;if(T("0",[]),I.validateCity()){var e=I.cityID;R(a.RegionType.District,e,function(i){e==I.cityID&&T(I.districtID,i)})}},onDistrictEdited:function(){I.districtsLoaded&&I.validateDistrict()},onAddressEdited:function(){I.loaded&&I.validateAddress()},onConfirm:function(){if(I.enabled&&I.validate_()){var e=function(e){null!=g&&null!=m?l.back("order_checkout.html?"+n.buildQuery(n.getParameters(),{sel_address_id:e.address_id})):l.back(n.buildURL({address_id:null,sel_address_id:null,uid:null},"addresses.html?"+n.buildQuery(n.getParameters())))},i=function(){I.setUserInteractionEnabled_(!0)},t={uid:f,name:I.receiver,mobile:I.mobile,province_id:I.provinceID,city_id:I.cityID,district_id:I.districtID,address:I.address,is_default:I.is_default};I.setUserInteractionEnabled_(!1),I.isEdit?n.apiRequest("POST","address/"+v,t,e,i):n.apiRequest("POST","address",t,e,i)}},onDelete:function(){if(I.enabled){I.setUserInteractionEnabled_(!1);var i=function(){n.apiRequest("DELETE","address/"+v,null,function(){var e=n.buildURL({sel_address_id:null,address_id:null,uid:null},"addresses.html?"+n.buildQuery(n.getParameters()));g&&m?l.reload(e):l.back(e)},function(){I.setUserInteractionEnabled_(!0)})};n.showConfirm(e,i,function(){I.setUserInteractionEnabled_(!0)})}},loadWeixinAddress:function(){var e=JSON.parse(localStorage.getItem("weixinInfo"));if(!e)return localStorage.setItem("reloadAddress","true"),void y();var i=e.access_token,t=e.expire_time;if(!i||!t)return localStorage.setItem("reloadAddress","true"),void y();var r=(new Date).getTime()/1e3-10;if(r>=t)return localStorage.setItem("reloadAddress","true"),void y();var d=s.ApiKey.WeChat,a=Math.random().toString().substring(2),l=Date.now().toString(),c=location.href.split("#")[0],u="accesstoken="+i+"&appid="+d+"&noncestr="+a+"&timestamp="+l+"&url="+c,f=o.hex_sha1(u);n.logError("editAddress",i.toString()+"::"+l.toString()+"::start"),WeixinJSBridge.invoke("editAddress",{appId:d,scope:"jsapi_address",signType:"sha1",addrSign:f,timeStamp:l,nonceStr:a},function(e){if("edit_address:ok"==e.err_msg){n.logError("editAddress",i.toString()+"::"+l.toString()+"::success");var t={national_code:e.nationalCode,address:e.addressDetailInfo,name:e.userName,mobile:e.telNumber,is_default:"0"};n.apiRequest("POST","address/weixin",t,function(e){_.length>0&&""!=n.getParameter("allowed_regions")&&_.indexOf(e.province_id)<0?n.showToast("地址添加成功，但不在配送范围"):(w(e),I.isEdit=!0,v=e.address_id)})}else e.err_desc&&n.showToast("获取失败"),n.logError("editAddress",i.toString()+"::"+l.toString()+"::"+JSON.stringify(e))})},validateReceiverCheck:function(){return null!=I.receiver&&I.receiver.length>c?(n.showToast(u),!1):I.validateReceiver()},validateReceiver:function(){return I.isReceiverValid=null!=I.receiver&&I.receiver.length>0},validateMobile:function(){var e=/(^1)\d{10}$/;return I.isMobileValid=e.test(I.mobile)},validateProvince:function(){return I.isProvinceIDValid=A(I.provinceID,I.provinces)},validateCity:function(){return I.isCityIDValid=A(I.cityID,I.cities)},validateDistrict:function(){return I.isDistrictIDValid=A(I.districtID,I.districts)},validateAddress:function(){return I.isAddressValid=null!=I.address&&I.address.length>0},validate_:function(){var e=!0;return e=I.validateReceiverCheck()&&I.validateMobile()&&I.validateProvince()&&I.validateCity()&&I.validateDistrict()&&I.validateAddress()},setUserInteractionEnabled_:function(e){I.enable=e,I.enable?(document.querySelector("#confirm_address").style.opacity="1",document.querySelector("#delete_address").style.opacity="1"):(document.querySelector("#confirm_address").style.opacity="0.5",document.querySelector("#delete_address").style.opacity="0.5")}}),avalon.scan(document.body),localStorage.getItem("reloadAddress")&&(localStorage.removeItem("reloadAddress"),I.loadWeixinAddress())},k=function(){L(),null==v?n.apiRequest("GET","regions",null,function(e){w(e),d.hide(),I.show="visible"},null):n.apiRequest("GET","address/"+v,null,function(e){w(e)},null)};E(function(){k()})})}]);