webpackJsonp([37],{0:function(e,r,n){"use strict";n(36);var o=n(4),t=n(1),a=n(3),s=n(7),i=n(24);t.prepare({requireLogin:!0},function(){var e="确定取消订单？",r="是否确认收货？",d="您还没有任何相关订单哦",l="您已经没有更多的订单了",u="亲，确认延长收货订单？(每笔订单只能延长一次哦~)",c="亲，您已经延长过收货时间哦~",p="亲，距离结束时间3天才可以申请哦~",_="延长收货成功!",f="延长收货失败!",g="已确认，待抽奖",m=10,h="order_combined_status",y="order_status_desc",v={All:0,PendingPay:1,Shipping:2,Collecting:3,Evaluating:4},E=["all","unpaid","unshipping","unreceived","unrated"],b=new Date("2015/11/05 00:00:00").getTime(),O=t.getParameter("type"),T=null,S=null,C=[],I=[],w=[],R=function(){null==S&&(S=avalon.define({$id:"root",isLoading:!1,orderType:null,orders:[],message:null,noOrderAtAll:!1,userInteractionEnabled:!0,switchList:function(e){if(S.userInteractionEnabled&&e!=S.orderType){Navigation.replaceURL(t.buildURL({type:e})),S.isLoading=I[e],S.orderType=e,S.orders=[],S.message=null;var r=C[e];null==r?N(e):S.orders=JSON.parse(JSON.stringify(r))}},showOrderDetails:function(e){t.saveToLocalStorage("ORDER_INFO_CACHES",JSON.stringify(C[S.orderType]));var r={type:S.orderType,sp:document.getElementsByTagName("body")[0].scrollTop},n=t.buildURL(r);Navigation.replaceURL(n,function(){Navigation.forward("order.html?order_sn="+e+"&type="+S.orderType)})},payOrder:function(e){if(S.userInteractionEnabled){var r=e.order_sn,n=e.order_goods[0].goods_name;t.isWeChatPlatform()?(S.setUserInteractionEnabled_(!1),payment.pay(s.PaymentType.WeChat,r,n,function(e){S.setUserInteractionEnabled_(!0)},!0)):S.showOrderDetails(r)}},cancelOrder:function(r){if(S.userInteractionEnabled){S.setUserInteractionEnabled_(!1);var n=function(){var e=r.order_sn;t.apiRequest("POST","order/"+e+"/cancel",null,function(){S.setUserInteractionEnabled_(!0),S.markOrderCancelled_(r)},function(){S.setUserInteractionEnabled_(!0)})};t.showConfirm(e,n,function(){S.setUserInteractionEnabled_(!0)})}},showExpress:function(e){if(S.userInteractionEnabled){S.setUserInteractionEnabled_(!1);var r=e.order_sn;n(21)(function(e){S.setUserInteractionEnabled_(!0),e.load(r),e.show()},function(){S.setUserInteractionEnabled_(!0),t.showToast(Error.messageFromCode(0))})}},extendReception:function(e){var r=function(){return e.can_extend_receive.hasExtended?void t.showToast(c):e.can_extend_receive.time?void t.apiRequest("POST","order/"+e.order_sn+"/extention",null,function(r){e.can_extend_receive.hasExtended=!0,t.showToast(_)},function(){t.showToast(f)}):void t.showToast(p)};t.showConfirm(u,r,function(){})},confirmShipment:function(e){if(S.userInteractionEnabled){S.setUserInteractionEnabled_(!1);var o=function(){var r=e.order_sn,o=e.order_goods[0].goods_id,a=e.order_goods[0].thumb_url,s=document.getElementsByTagName("body")[0].scrollTop;t.apiRequest("POST","order/"+r+"/received",null,function(i){S.setUserInteractionEnabled_(!0),S.markOrderReceived_(e),t.saveToLocalStorage("ORDER_INFO_CACHES",JSON.stringify(C[S.orderType]));var d=i.share_code||"";if(t.isNativePlatform())n(31)(function(e){e.load(r,o,a,d,s,S.orderType,S.orders,C,null)});else{var l={type:S.orderType,sp:s},u=t.buildURL(l);Navigation.replaceURL(u,function(){Navigation.forward("deal_made.html?"+t.buildQuery({order_sn:r,goods_id:o,thumb_url:a,type:S.orderType,from:"orders"}))})}},function(){S.setUserInteractionEnabled_(!0)})},a=function(){Navigation.forward("download.html?src=weixin&campaign=gzh&cid=querenshouhuo")},i=function(){S.setUserInteractionEnabled_(!0)};t.isNativePlatform()?t.showConfirm(r,o,function(){S.setUserInteractionEnabled_(!0)}):t.showJSAlert(s.AlertType.Confirm.ConfirmShipment,a,o,i)}},forwardEvaluate:function(e){var r=e.order_sn,n=e.order_goods[0].goods_id,o=e.order_goods[0].thumb_url;t.saveToLocalStorage("ORDER_INFO_CACHES",JSON.stringify(C[S.orderType]));var a={type:S.orderType,sp:document.getElementsByTagName("body")[0].scrollTop},s=t.buildURL(a);Navigation.replaceURL(s,function(){Navigation.forward("comments.html?"+t.buildQuery({order_sn:r,goods_id:n,thumb_url:o,type:S.orderType}))})},showMessage:function(){S.noOrderAtAll=!1,w[S.orderType]&&(S.orders.length<=0?(S.message=d,S.noOrderAtAll=!0):S.orders.length>=m&&(S.message=l))},markOrderCancelled_:function(e){var r=e.order_sn,n=s.OrderCombinedStatus.Cancelled;S.markCacheOrderStatus_(r,n),[v.PendingPay,v.Shipping].forEach(function(e){var r=C[e];if(null!=r)for(var o=r.length-1;o>=0;--o)r[o][h]==n&&r.splice(o,1)}),S.orders=C[S.orderType]},markOrderReceived_:function(e){var r=e.order_sn,n=s.OrderCombinedStatus.Received;S.markCacheOrderStatus_(r,n);var o=C[v.Collecting],t=C[v.Evaluating];if(null!=o)for(var a=o.length-1;a>=0;--a)o[a][h]==n&&(null!=t&&t.push(o[a]),o.splice(a,1));S.orders=C[S.orderType]},markCacheOrderStatus_:function(e,r){var n=i.getOrderCombinedStatusDescription(r);C.forEach(function(o){o.forEach(function(o){o.order_sn==e&&(o[h]=r,o[y]=n,o[h]==s.OrderCombinedStatus.Received&&(o.rate_status=s.rateStatus.rateEnable))})})},removeOrderAtIndex_:function(e){S.orders.removeAt(e);var r=C[S.orderType];null!=r&&e>=0&&e<r.length&&r.splice(e,1)},setUserInteractionEnabled_:function(e){S.userInteractionEnabled=e}}),S.$watch("orders",function(){S.showMessage()}),O&&"undefined"!=O?S.orderType=parseInt(O,10):S.orderType=v.All,avalon.scan(document.body),N(S.orderType))},N=function(e){if(!I[e]&&!w[e]){if(null==C[e]&&(C[e]=[]),I[e]=!0,e==S.orderType&&(S.isLoading=!0,S.message=null),null==T&&(T={sp:t.getParameter("sp")||null}),localStorage.getItem("ORDER_INFO_CACHES")&&null!=T.sp)return C[e]=JSON.parse(localStorage.getItem("ORDER_INFO_CACHES")),localStorage.removeItem("ORDER_INFO_CACHES"),C&&(e==S.orderType&&S.orders.pushArray(C[e]),document.getElementsByTagName("body")[0].scrollTop=T.sp,I[e]=!1,w[e]=C[e].length%10!=0,S.orders.length<=0&&(w[e]=!0),e==S.orderType&&(S.isLoading=I[e],S.showMessage())),T.sp=null,void Navigation.replaceURL(t.buildURL({sp:null,order_sn:null}));localStorage.getItem("ORDER_INFO_CACHES")&&localStorage.removeItem("ORDER_INFO_CACHES");var r=C[e].length,n=Math.floor(r/m)+1,o=function(r){I[e]=!1,w[e]=m>r,e==S.orderType&&(S.isLoading=I[e])};t.apiRequest("GET","ordersv2/"+E[e]+"?"+t.buildQuery({page:n,size:m}),null,function(n){var t=n.orders||[],a=n.timestamp||Date.parse(new Date);o(t.length),t.forEach(function(e){var r=e.order_status,n=e.pay_status,o=e.shipping_status,t=i.getOrderCombinedStatus(r,n,o);e[h]=t,e[y]=i.getOrderCombinedStatusDescription(t);var d=null,l=e.order_goods;if(null!=l&&l.length>0&&(d=l[0]),null!=d){var u=d.lucky_draw,c=e.lucky_draw_result;e.rate_status=e.rate_status||"0",e.used_coupons=parseInt(d.goods_price)*parseInt(d.goods_number||"1")>parseInt(e.order_amount),e.order_amount=(e.order_amount/100).toFixed(2),e.goods_price=(d.goods_price/100).toFixed(2),e.spec=d.spec||"",e.goods_number=d.goods_number||"1",e.coupons=e.coupons||[],e.order_time=e.order_time||0,e.show=parseFloat(e.goods_price)>.09||1e3*e.order_time-b>0,null!=u?(e.lucky_status=u.status,e.lucky_status<3&&t==s.OrderCombinedStatus.Confirmed&&(e[y]=g)):e.lucky_status=null,null!=c?e.lucky_result=c.status||"":e.lucky_result=null,t==s.OrderCombinedStatus.Unconfirmed&&0==e.order_amount&&a-e.order_time>=86400&&(e[y]=i.getOrderCombinedStatusDescription(s.OrderCombinedStatus.Expired)),t==s.OrderCombinedStatus.Shipping&&(e.can_extend_receive=function(){var r=parseInt(e.shipping_time)+1036800,n=r+259200,o=e.order_extention||{},t=o.extention_time||"0";return{time:a>r&&n>a,hasExtended:"0"!=t}}())}}),r==C[e].length&&(C[e].push.apply(C[e],t),e==S.orderType&&(S.orders.pushArray(JSON.parse(JSON.stringify(t))),S.showMessage()))},function(){o(!1)})}},U=function(){o(document).scroll(function(){null!=S&&o(document).scrollTop()+o(window).height()>=o(document).height()&&N(S.orderType)})};n(14)(function(e){window.payment=e,R(),a.hide(),U()},function(){location.reload()})})},14:function(e,r,n){n(2),e.exports=function(e,r){n.e(7,function(o){o?r():e(n(23))})}},21:function(e,r,n){n(2),e.exports=function(e,r){n.e(11,function(o){o?r():e(n(43))})}},31:function(e,r,n){n(2),e.exports=function(e,r){n.e(15,function(o){o?r():e(n(49))})}},36:function(e,r){}});