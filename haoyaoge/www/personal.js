webpackJsonp([46],{0:function(n,e,o){"use strict";o(85);var t=o(4),a=o(1),i=o(3),r=o(8),s=o(11),u=o(7);a.prepare({requireLogin:a.isEmbeddedBrowser(),regEvents:{onSceneReturn:function(n){n=n||{},Navigation.reload(n.url)}}},function(){var n="游客",e="未登录",o="退出登录",l="点击登录",c="刷新用户",f="http://pinduoduo.b0.upaiyun.com/base/unlogin_avatar.png",d=Math.min(t(window).width(),640),g=avalon.define({$id:"root",avatarURL:"",nickname:"",logoutText:a.isEmbeddedBrowser()?c:o,payCount:0,sendCount:0,recvCount:0,rateCount:0,newMsgCount:0,visible:"hidden",showAppDownload:a.isWeChatPlatform(),downloadApp:function(){Navigation.forward("download.html?src=weixin&campaign=gzh&cid=gerenzhongxin")},showOrders:function(n){Navigation.forward("orders.html?type="+n)},showLikes:function(){Navigation.forward("likes.html")},showGroups:function(){Navigation.forward("groups.html")},showLottory:function(){Navigation.forward("mylottery.html")},showAddresses:function(){Navigation.forward("addresses.html")},showCoupons:function(){Navigation.forward("coupons.html")},showCustomerServices:function(){Navigation.forward("post_sale.html")},showChatList:function(){Navigation.forward("chat_list.html")},showSuggestion:function(){Navigation.forward("suggestion.html")},login:function(){r.hasAccessToken()||Navigation.reload("login.html?from="+encodeURIComponent("personal.html"))},logout:function(){r.hasAccessToken()?r.logout(function(){a.isEmbeddedBrowser()?Navigation.reload("personal.html"):(localStorage.removeItem("LastPersonalMsg"),Navigation.reload("login.html?from="+encodeURIComponent("personal.html")))}):Navigation.reload("login.html?from="+encodeURIComponent("personal.html"))}}),h=function(){a.apiRequest("GET","orders/count",null,function(n){g.payCount=n.unpaid<99?n.unpaid:"···",g.sendCount=n.unshipping<99?n.unshipping:"···",g.recvCount=n.unreceived<99?n.unreceived:"···",g.rateCount=n.unrated<99?n.unrated:". . ."});var n=function(n){g.newMsgCount=99>n?n:"···"};s.hasNewMsg(!0,n)},p=function(o,a){r.hasAccessToken()?(g.avatarURL=r.getAvatarURL(o),g.nickname=a||n,h()):(g.avatarURL=f,g.nickname=e,g.logoutText=l),t(".nav_list li").height(.25*d+"px"),i.hide(),g.visible="visible",avalon.scan(document.body)},v=function(){r.hasAccessToken()?a.apiRequest("GET","user/me",null,function(n){p(n.avatar,n.nickname),localStorage.getItem(u.LocalStorageKey.UID)||a.saveToLocalStorage(u.LocalStorageKey.UID,parseInt(n.uid,10).toString(36))},function(){p()},!1,!0):p()};v()})},11:function(n,e,o){var t=o(1),a=o(6),i=o(8);o(10);n.exports=function(){var n=3e4,e=1,o={Open:0,Close:1,Authentication:2,Message:3},r=null,s=0,u={},l={},c=[],f=0,d=!1,g=void 0!==window.WebSocket,h=function(){return null!=r&&r.readyState==WebSocket.OPEN},p=function(){h()||null!=r&&r.readyState==WebSocket.CONNECTING||!g||(r=new WebSocket(a.pushDomain+"?"+t.buildQuery({access_token:i.getAccessToken(),role:"user"})),r.onopen=function(){setTimeout(function(){w(),m(o.Open)},50)},r.onclose=function(){setTimeout(function(){d=!1,m(o.Close)},50)},r.onerror=function(n){},r.onmessage=function(n){if(null!=n&&null!=n.data){var e=JSON.parse(n.data);if(null!=e){var t=e.response,a="ok"===e.result;if(!a&&null!=e.result,"auth"==t)return a&&(d=!0),m(o.Authentication,a);var i=e.request_id;if(null!=i){var r=l[i];null!=r&&setTimeout(function(){r(e)},50)}m(o.Message,e)}}})},v=function(n,e){if(null==e)return null;var o=s++;return u[o]={type:n,handler:e},o},m=function(n){for(var e=[],o=1;o<arguments.length;++o)e.push(arguments[o]);for(var t in u){var a=u[t];a.type==n&&setTimeout(function(){a.handler.apply(null,e)},50)}},w=function(n){if(g){var o=null;return"object"==typeof n&&(o=e++,n.request_id=o,c.push(n)),h()?(c.forEach(function(n){r.send(JSON.stringify(n))}),c=[]):p(),o}};return{isOpen:h,isSupport:g,hasAuthenticated:function(){return g?d:!1},onOpen:function(n){return v(o.Open,n)},onClose:function(n){return v(o.Close,n)},onAuthenticationResult:function(n){return g?v(o.Authentication,n):void 0},onMessage:function(n){return g?v(o.Message,n):void 0},unregister:function(n){delete u[n]},keepAlive:function(){if(g)if(h()){var e=Date.now();e-f>=n&&(w({cmd:"heartbeat"}),f=e)}else p()},send:function(n){g&&w(n)},request:function(n,e){if(g){var o=w(n);return null==o||null==e?o:void(l[o]=e)}},hasNewMsg:function(n,e){if(g&&i.hasAccessToken()){var o=JSON.parse(localStorage.getItem("LastPersonalMsg"))||{},a=o.key||0,r=o.time||0;if(0==a||n){var s=Date.now().toString(),u={key:a,time:r};if(3e4>s-r&&!n)return u.time=s,void localStorage.setItem("LastPersonalMsg",JSON.stringify(u));var c=0,f=w({cmd:"latest_conversations",page:1,size:20});l[f]=function(n){for(var o=n.conversations,a=document.querySelector("#footer_personal i"),i=0;i<o.length;i++)"read"!=o[i].status&&c++;null!=a&&0!=c&&a.classList.add("fb-badge1"),u.key=c,u.time=s,localStorage.setItem("LastPersonalMsg",JSON.stringify(u)),null!=e&&t.call(e,c)}}}},alertNotSupport:function(n){g||t.showAlert("您的系统版本不支持这个功能(Android系统版本至少为4.3)",function(){t.call(n)})}}}()},85:function(n,e){}});