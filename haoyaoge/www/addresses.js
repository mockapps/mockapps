webpackJsonp([83],[function(e,r,s){"use strict";var d=(s(4),s(8)),t=s(1),a=s(3),i=s(7),o=s(6),n=s(26),l=s(5);t.prepare({requireLogin:!0,regEvents:{onSceneReturn:function(e){e=e||{},l.reload(e.url)}}},function(){var e=navigator.userAgent.match(/MicroMessenger\/([\d\.]+)/i),r=function(){var e=t.getParameter("allowed_regions");return null==e?[]:e.split(",")}(),s=t.getParameter("goods_id"),u=t.getParameter("sku_id"),c=function(){d.logout(function(){l.reload()})},g=function(d){r.length>0&&""!=t.getParameter("allowed_regions")&&(d=d.filter(function(e){return r.indexOf(e.province_id)>=0}));var a=avalon.define({$id:"address",addresses:d||[],selectedAddressID:t.getParameter("sel_address_id")||null,showLoadWeixinAddress:t.isWeChatPlatform()&&e&&e[1]>="5.0",addAddress:function(){var e="address.html"+location.search;s&&u?l.reload(e):l.forward(e)},chooseAddress:function(e){var r=e.address_id,s=e.uid;return null!=a.selectedAddressID?void l.back("order_checkout.html?"+t.buildQuery(t.getParameters(),{sel_address_id:r})):void(e.is_default!=i.AddressClass.Default&&t.apiRequest("POST","address/"+r,{uid:s,name:e.name,mobile:e.mobile,country_id:e.country_id,province_id:e.province_id,city_id:e.city_id,district_id:e.district_id,address:e.address,is_default:i.AddressClass.Default},function(){for(var r=0;r<a.addresses.length;r++)d[r].is_default=i.AddressClass.Common;e.is_default=i.AddressClass.Default,a.addresses=a.addresses},null))},edit:function(e,r){event&&(event.preventDefault(),event.stopPropagation());var d="address.html?"+t.buildQuery(t.getParameters(),{address_id:r,uid:e});s&&u?l.reload(d):l.forward(d)},loadWeixinAddress:function(){var e=JSON.parse(localStorage.getItem("weixinInfo"));if(!e)return localStorage.setItem("reloadAddresses","true"),void c();var s=e.access_token,d=e.expire_time;if(!s||!d)return localStorage.setItem("reloadAddresses","true"),void c();var i=(new Date).getTime()/1e3-10;if(i>=d)return localStorage.setItem("reloadAddresses","true"),void c();var l=o.ApiKey.WeChat,u=Math.random().toString().substring(2),g=Date.now().toString(),f=location.href.split("#")[0],m="accesstoken="+s+"&appid="+l+"&noncestr="+u+"&timestamp="+g+"&url="+f,_=n.hex_sha1(m);t.logError("editAddress",s.toString()+"::"+g.toString()+"::start"),WeixinJSBridge.invoke("editAddress",{appId:l,scope:"jsapi_address",signType:"sha1",addrSign:_,timeStamp:g,nonceStr:u},function(e){if("edit_address:ok"==e.err_msg){t.logError("editAddress",s.toString()+"::"+g.toString()+"::success");var d={national_code:e.nationalCode,address:e.addressDetailInfo,name:e.userName,mobile:e.telNumber,is_default:"0"};t.apiRequest("POST","address/weixin",d,function(e){r.length>0&&""!=t.getParameter("allowed_regions")&&r.indexOf(e.province_id)<0?t.showToast("地址添加成功，但不在配送范围"):a.addresses.push(e)})}else e.err_desc&&t.showToast("获取失败"),t.logError("editAddress",s.toString()+"::"+g.toString()+"::"+JSON.stringify(e))})}});avalon.scan(document.body),localStorage.getItem("reloadAddresses")&&(localStorage.removeItem("reloadAddresses"),a.loadWeixinAddress())},f=function(){t.apiRequest("GET","addresses",null,function(e){a.hide(),g(e)},function(){a.hide()})};f()})}]);