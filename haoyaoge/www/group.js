webpackJsonp([36],{0:function(o,e,r){"use strict";var t=r(4),a=r(1),s=r(46),i=r(3),n=r(7),u=r(6),l=r(8),d=r(13);Navigation.replaceURL(a.buildURL({src:null,at:null,api_uid:null})),a.prepare({requireLogin:!0,shareInfo:{noDefaultShare:!0,forceShareToWeChatTimeline:!0}},function(){var o="Oops! 这个团已经不在地球上了，快去首页火拼吧！",e=[{TITLE:["快来入团吧","入团成功","开团成功"],DETAIL:["就差你了","快去邀请好友加入吧","快去邀请好友加入吧"]},{TITLE:["来晚了一步！该团已被挤爆","团购成功","团购成功"],DETAIL:["求人不如求自己，自己当团长吧！","我们会尽快为您发货，请耐心等待","我们会尽快为您发货，请耐心等待"]},{TITLE:["来晚了一步！","团购失败","团购失败"],DETAIL:["","",""]}],p="http://pinduoduo.b0.upaiyun.com/base/avatar_4_64.png",g={GROUP:{DESC:u.shop.name+"，优质商品新鲜直供，一起实惠一起拼",UNCOMPLETE_WITH_GOODS:"我买了“{0}”，大家快来昊幺哥吧！",UNCOMPLETE_WITH_GOODS_AND_NUMBER:"我参加了“{0}”拼单，还差{1}个人！",COMPLETE_WITH_GOODS:"终于“拼”到了“{0}”，大家快来拼单吧！"},UNGROUP:{UNCOMPLETE_WITH_GOODS:"“{0}”拼单，大家一起来玩吧！",UNCOMPLETE_WITH_GOODS_AND_NUMBER:"“{0}”拼单，还差{1}个人！",COMPLETE_WITH_GOODS:"{0}，大家快来拼单吧！"}},c={NORMAL:"http://pinduoduo.b0.upaiyun.com/base/group_app_banner_new.png",NEWBEE:"http://pinduoduo.b0.upaiyun.com/base/group_app_banner_newbee.png"},m="该商品是APP专享团商品，请在APP中购买和参团。",f=40,_=1,h=null,v=a.getParameter("group_order_id")||a.getParameter("id")||"",I=!1,O={},T=0,N="1"==localStorage.getItem("afterpayed"),D=N?"":"您已参加过此团";localStorage.setItem("afterpayed","");var w=["",""],S=(new Date).getTime(),b="",G=!1,E=parseInt((new Date).getTime()/1e3,10),R={},y=null,U=!1,L=function(o){var e="user/me",r="http://mp.weixin.qq.com/s?__biz=MzIxNzA1NDEyNQ==&mid=401077092&idx=1&sn=b5c3cacd949a29675119eb85c66def50#rd";a.apiRequest("GET",e,null,function(e){return e&&e.uid&&(R.user_id=e.uid||"",F()),y=e.has_login_app,G=!0,e.is_subscribed?void a.call(o):(localStorage.setItem("LASTGROUPORDERID",v),void(location.href=r))},function(){a.call(o)})},A=function(){var o=function(o){var e=function(o){for(var e=[],r=0;r<o.length;r++){var t=o[r];e.push({avatar:t.avatar,nickname:t.nickname,uid:t.uid,joinTime:parseInt(t.join_time)})}return e.sort(function(o,e){return o.joinTime-e.joinTime}),e},r=function(o,e,r,t,s){for(var i=function(o){if(null==o)return null;for(var e=[],r=0;r<o.length;r++)e.push({skuID:o[r].id,quantity:o[r].quantity||0});return e},n=i(o.skus),u=!1,l=0;l<n.length;l++)if(n[l].quantity>0){u=!0;break}var d=function(){var e=o.list_desc;if(null==e||e.length<=0)return[];var r=[];try{r=JSON.parse(e)}catch(t){}return r}(),p=parseFloat(o.goods_price/100).toFixed(2),g={num:t,price:p};return{goodsID:o.goods_id,goodsName:a.replaceGoodsTpl(o.goods_name,g),goodsNumber:o.goods_number,price:p,thumbUrl:o.thumb_url,imageUrl:o.image_url,listDescriptions:d,isOnSale:e&&u,isDeleted:r,goodsType:o.goods_type,skus:n,isApp:s,isRefundable:"1"==o.is_refundable,shareDesc:a.replaceGoodsTpl(o.share_desc,g),eventType:o.event_type}},t=function(o,e){return{mallName:o.mall_name,mallDesc:o.mall_desc,logo:o.logo,mallSales:o.mall_sales||0,mallID:e}};if(null==o.order||null==o.order.order_goods)return void W();var s=parseInt(o.expire_time,10),i=o.status;E>s&&i==n.GroupStatus.OnGoing&&(i=n.GroupStatus.Failed);var u="1"==o.is_app;return{callerID:o.caller_id,requireNum:parseInt(o.customer_num),groupOrderID:o.group_order_id,groupRole:parseInt(o.group_role),ownerID:o.owner_id,status:i,successTime:o.success_time,expireTime:s,users:e(o.users),orderGoods:r(o.order.order_goods[0],o.is_onsale||"1",o.is_deleted||"0",parseInt(o.customer_num),u),mallInfo:t(o.order.mall,o.order.mall_id),groupID:o.group_id,appInviteCode:o.app_invite_code||""}};a.apiRequest("GET","group_order/"+v,null,function(e){e.server_time&&(E=parseInt(e.server_time,10),S=1e3*E);var r=o(e.group_order);a.isWeChatPlatform()&&parseFloat(r.orderGoods.price)<n.ForceContactBound?L(function(){P(r)}):P(r);var t=r.orderGoods.eventType;t==_&&(U=!0)},function(o){o==d.GroupInvalid.code&&(i.hide(),W())},!1,!1,"1"==a.getParameter("is_group_app"))},P=function(o){if(b=o.orderGoods.goodsID,I=!o.orderGoods.isOnSale,O.status=parseInt(o.status),O.groupRole=parseInt(o.groupRole),null===O.groupRole||void 0==O.groupRole)if(O.groupRole=0,o.ownerID==o.callerID)O.groupRole=2;else for(var e in o.users)if(o.users[e].uid==o.callerID){O.groupRole=1;break}T=Math.max(o.requireNum-o.users.length,0),0==O.groupRole&&(D=""),q(o),window.endtime=1e3*o.expireTime,M(),avalon.scan(document.body);var r=document.querySelector(".pp_users_item").getElementsByTagName("img")[0];h.avatarHeight=t(r).innerWidth(),H(),B(),i.hide()},x=function(o){return 10>o?"0"+o:o},M=function(){var o=window.endtime,e=o-S,r=e/1e3,t=Math.floor(r/60),a=Math.floor(t/60),s=Math.floor(a/24);s%=365,a%=24,t%=60,r=Math.floor(r%60),o>=S?(h.leftHours=x(a),h.leftMinutes=x(t),h.leftSeconds=x(r),h.leftDays=s,S+=1e3,window.setTimeout(function(){M()},1e3)):(h.leftHours="00",h.leftMinutes="00",h.leftSeconds="00",h.leftDays=0)},C=function(){for(var o=Math.max(h.groupOrderInfo.requireNum,h.groupOrderInfo.users.length),e=0;o>e;e++)if(h.usersAvatar[e]={},U&&(h.usersAvatar[e].avatarClass2="pp_users_lottery"),h.groupOrderInfo.users[e]){var r=h.groupOrderInfo.users[e].avatar||"";h.usersAvatar[e].avatarImg=l.getAvatarURL(r),h.usersAvatar[e].avatarClass="pp_users_normal"}else h.usersAvatar[e].avatarImg=p,h.usersAvatar[e].avatarClass="pp_users_blank"},k=function(o){var e=h.groupOrderInfo.users.length,r=[];if(e>f&&!o){var t=10*(Math.floor(e/10)-1);r=h.groupOrderInfo.users.slice(0,f/2).concat(null,h.groupOrderInfo.users.slice(t)),h.hideNum=e-r.length+1}else r=h.groupOrderInfo.users;h.usersList=[];for(var a=0;a<r.length;a++){var s={};null==r[a]?s=null:(s.avatarImg=l.getAvatarURL(r[a].avatar),s.nickname=r[a].nickname||"游客",s.joinTime=r[a].joinTime),h.usersList.push(s)}},B=function(){var o={before:!0,position:".group_mall"},e=N?1:0;R={page_type:N?"confirm_group":"view_group",event_type:"rec_under",token:localStorage.getItem("AccessToken")||"",uid:a.getCookieByName("api_uid"),trigger:"auto"},a.apiRequest("GET","recommendation?goods_id="+b+"&referrer=group_order&page_type="+e,null,function(e){r(17)(function(r){r.load(e.list,o,!1,0==h.groupStatus?-20:0)}),R.g_ids={};for(var t=0;t<e.list.length;t++)R.g_ids[t.toString()]=e.list[t].goods_id;F()},function(){R.g_ids={},F()})},q=function(o){if(null==h){h=avalon.define({$id:"group",mall:{mallID:o.mallInfo.mallID,name:o.mallInfo.mallName,logo:o.mallInfo.logo,soldQuantity:o.mallInfo.mallSales},goodsInfo:o.orderGoods,isSoldOut:!o.orderGoods.isOnSale,groupOrderInfo:o,shareDesc:o.orderGoods.shareDesc,orderGoods:o.orderGoods,leftUserNum:0,groupStatus:O.status,groupRole:O.groupRole,groupClass:O.status==n.GroupStatus.Success?"tm_succ":O.status==n.GroupStatus.Failed?"tm_err":"",titleStatus:O.status==n.GroupStatus.OnGoing?0:O.status==n.GroupStatus.Success?O.groupRole!=n.GroupRole.NotInGroup?0:1:2,tips:{title:e[O.status].TITLE[O.groupRole],txt:e[O.status].DETAIL[O.groupRole]},bottomStatus:0==O.status?O.groupRole>0&&T>0?1:2:0,shareitVisible:!1,isNewUser:!1,qrCodeImg:"http://pinduoduo.b0.upaiyun.com/base/qrcode_pinduoduo.png",leftHours:"00",leftMinutes:"00",leftSeconds:"00",leftDays:0,usersAvatar:[],usersList:[],hideNum:0,showExplainBg:!1,explainBgImg:"",explainBgClose:"",shopName:u.shop.name,subscribedTip:"",mallService:[{isVisible:!0,type:"全国包邮",m_class:"mall_detail_1"},{isVisible:!0,type:"7天无理由退换货",m_class:"mall_detail_2"},{isVisible:!0,type:"正品保障",m_class:"mall_detail_3"},{isVisible:!1,type:"海关监督",m_class:"mall_detail_4"},{isVisible:!1,type:"进口保税",m_class:"mall_detail_5"}],showAppBanner:!a.isNativePlatform(),appBannerImg:null,groupID:o.groupID,showAllTitle:"查看全部参团详情",showAllFlag:!1,avatarHeight:45,hasLotteryRule:U,showLotteryRule:function(){i.show(),event.stopPropagation();var o="lucky_draw/"+b;a.apiRequest("GET",o,null,function(o){0==o.length?(i.hide(),a.showToast("该商品暂无抽奖规则")):r(60)(function(e){e.load(o,function(){i.hide(),e.show()})})},function(){i.hide(),a.showToast("该商品暂无抽奖规则")})},gotoMall:function(){Navigation.forward("mall_page.html?"+a.buildQuery(a.getParameters(),{mall_id:h.mall.mallID}))},goHome:function(){Navigation.home()},gotoGoodsDetail:function(){O.status==n.GroupStatus.OnGoing?Navigation.forward("goods.html?"+a.buildQuery(a.getParameters(),{goods_id:h.groupOrderInfo.orderGoods.goodsID,status:h.groupStatus,group_role:h.groupRole,group_order_id:v})):Navigation.forward("goods.html?"+a.buildQuery({goods_id:h.groupOrderInfo.orderGoods.goodsID,status:h.groupStatus,group_role:h.groupRole}))},joinGroup:function(){var o=h.groupOrderInfo.orderGoods;o.isApp&&!a.isNativePlatform()?r(54)(function(e){e.load({code:h.groupOrderInfo.appInviteCode,price:o.price},e.show)}):o.skus&&(o.skus.length>1?Navigation.forward("goods.html?"+a.buildQuery(a.getParameters(),{goods_id:o.goodsID,group_order_id:v,status:h.groupStatus,group_role:h.groupRole})):Navigation.forward("order_checkout.html?"+a.buildQuery(a.getParameters(),{sku_id:o.skus[0].skuID,group_order_id:v,goods_id:o.goodsID,group_id:h.groupID,showwxpaytitle:"1"})))},createGroup:function(){if(h.isSoldOut)return void Navigation.home();var o=h.groupOrderInfo.orderGoods;return o.isApp&&!a.isNativePlatform()?void h.showDownloadNotification():void(o.skus&&(o.skus.length>1?Navigation.forward("goods.html?"+a.buildQuery({goods_id:o.goodsID,status:h.groupStatus,group_role:h.groupRole})):Navigation.forward("order_checkout.html?"+a.buildQuery({sku_id:o.skus[0].skuID,goods_id:o.goodsID,group_id:h.groupID,showwxpaytitle:"1"}))))},showGroupRule:function(){Navigation.forward("tuan_rule.html")},gotoMyGroups:function(){Navigation.forward("groups.html")},showShareTip:function(){a.isNativePlatform()?r(22)(function(o){o.show(!0,D,w)}):h.shareitVisible=!0},hideShareTip:function(){h.shareitVisible=!1},showAllUsers:function(){k(!0)},showExplain:function(){""==h.explainBgImg&&(h.explainBgImg="url(http://pinduoduo.b0.upaiyun.com/base/group_explain.png)"),""==h.explainBgClose&&(h.explainBgClose="http://pinduoduo.b0.upaiyun.com/sku/quit_button.png"),h.showExplainBg=!0},hideExplain:function(){h.showExplainBg=!1},clickAppBanner:function(){y?Navigation.forward("download.html?src=weixin&campaign=gzh&cid=banner"):Navigation.forward("download.html?src=weixin&campaign=gzh&cid=bannerxslb")},showAllUserList:function(){h.showAllFlag?(h.showAllTitle="查看全部参团详情",t("#show_all").removeClass("hideAllUserList"),t("#recommend").css("marginTop","0"),h.showAllFlag=!1):(h.showAllTitle="收起全部参团详情",t("#show_all").addClass("hideAllUserList"),t("#recommend").css("marginTop","-20px"),h.showAllFlag=!0)},showDownloadNotification:function(){event.stopPropagation(),r(27)(function(o){o.load({title:"APP专享团",content:m},function(){o.show()})})}}),0==h.groupStatus&&(h.showAllFlag=!0);h.groupOrderInfo.users.length;h.leftUserNum=T,T>0&&(w=["还差"+h.leftUserNum+"人就能组团成功","快邀请更多小伙伴参团吧"]),h.isSoldOut&&0==O.status&&(h.bottomStatus=0),h.subscribedTip=D,C(),k();var s=h.groupOrderInfo.orderGoods.goodsType;3==s?h.mallService[4].isVisible=!0:h.mallService[3].isVisible=!0,h.groupOrderInfo.orderGoods.isRefundable||(h.mallService[1].isVisible=!1);var l=h.mall.mallID;a.apiRequest("GET","mall/"+l+"/info",null,function(o){h.mall.soldQuantity=o.mall_sales||"0"},function(){})}},W=function(){"1"==a.getParameter("is_group_app")?(a.showToast("您输入的专享码有误！"),Navigation.home()):a.showAlert(o,function(){Navigation.home()})},H=function(){var o,e,t=h.groupOrderInfo.orderGoods,i=h.shareDesc||g.GROUP.DESC,n=t.goodsName;0!=O.groupRole?T>0?(o=a.format(g.GROUP.UNCOMPLETE_WITH_GOODS,n),e=a.format(g.GROUP.UNCOMPLETE_WITH_GOODS_AND_NUMBER,n,T)):(o=a.format(g.GROUP.COMPLETE_WITH_GOODS,n),e=o):(o=a.format(g.UNGROUP.UNCOMPLETE_WITH_GOODS,n),e=T>0?a.format(g.UNGROUP.UNCOMPLETE_WITH_GOODS_AND_NUMBER,n,T):a.format(g.UNGROUP.COMPLETE_WITH_GOODS,n));var u=function(){for(var n=JSON.parse(JSON.stringify(s.Group)),u=0;u<s.ListDescription.length;++u){var l=t.listDescriptions[u];if(!(null==l||l.length<=0)){var d=JSON.parse(JSON.stringify(s.ListDescription[u]));d.data=l,n.items.push(d)}}var p=a.getCookieByName("api_uid");a.prepareShare({title:o,message:i,timelineMessage:e,imageURL:t.imageUrl,thumbnailURL:t.thumbUrl,shareURL:Navigation.GroupUrl+location.search+(p?"&api_uid="+p:""),template:n,forceShareToWeChatTimeline:!0,subscribedTip:D,subscribedDesc:w,infoVisibleFlag:!0},function(o){o&&O.groupRole>0&&0==O.status&&(a.isEmbeddedBrowser()?h.showShareTip():r(22)(function(o){o.show(!0,D,w)}))})};G?h.appBannerImg=y?c.NORMAL:c.NEWBEE:a.apiRequest("GET","user/me",null,function(o){o&&o.uid&&(R.user_id=o.uid||"",F()),y=o.has_login_app,h.appBannerImg=y?c.NORMAL:c.NEWBEE},function(){}),u()};A();var F=function(){null!=R.g_ids&&null!=R.user_id&&(localStorage.getItem(n.LocalStorageKey.UID)||a.saveToLocalStorage(n.LocalStorageKey.UID,parseInt(R.user_id,10).toString(36)),a.recommendRecord(R))};r(12)(function(){})})},12:function(o,e,r){r(2),o.exports=function(o,e){r.e(6,function(t){t?e():o(r(15))})}},17:function(o,e,r){r(2),o.exports=function(o,e){r.e(8,function(t){t?e():o(r(30))})}},27:function(o,e,r){r(2),o.exports=function(o,e){r.e(14,function(t){t?e():o(r(48))})}},54:function(o,e,r){r(2),o.exports=function(o,e){r.e(28,function(t){t?e():o(r(306))})}},60:function(o,e,r){r(2),o.exports=function(o,e){r.e(23,function(t){t?e():o(r(312))})}}});