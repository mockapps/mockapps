webpackJsonp([56],{0:function(n,e,a){a(81);var t=a(1),o=a(3);t.prepare({shareInfo:{noDefaultShare:!0,forceShareToWeChatTimeline:!0},title:"优惠券"},function(){var n,e=t.getParameter("event_id"),a=t.getParameter("mall_name"),i=null,u={XianJin:"现金券",ManJian:"满减券"},c={ToTake:"立即领取 >",Taken:"已领取 >"},r="领取成功！",s=function(){m();var a=function(e){var a=function(n){for(var e=[],a=0;a<n.length;a++){var t=n[a],o={batchID:t.batch_id,isTaken:t.is_taken,batchName:t.batch_name,startTime:1e3*t.start_time,typeLabel:t.discount==t.min_amount?u.XianJin:u.ManJian,discount:parseFloat((t.discount/100).toFixed(2)),catName:t.cat_name||"店铺优惠券"};o.endTime=o.startTime+864e5*t.duration,o.actionLabel=o.isTaken?c.Taken:c.ToTake,e.push(o)}return e};i.coupons=a(e.coupons||[]),i.banner=e.event_info.banner_image_url,n=e.server_time||parseInt((new Date).getTime()/1e3,10)};t.apiRequest("GET","mall/"+e+"/mall_coupons",null,function(n){a(n),l()},function(){l()})},l=function(){avalon.scan(document.body),i.show="visible",o.hide()},m=function(){null==i&&(i=avalon.define({$id:"root",show:"hidden",bannerHeight:""+.4*Math.min(window.innerWidth,640)+"px",coupons:[],banner:null,mallName:a,getCoupon:function(n,e){i.coupons[n].isTaken||t.apiRequest("POST","mall_coupon/take",{batch_ids:[e]},function(e){"1"==e.result&&(t.showToast(r),i.coupons[n].isTaken=!0,i.coupons[n].actionLabel=c.Taken)},function(){})}}))};s()})},81:function(n,e){}});