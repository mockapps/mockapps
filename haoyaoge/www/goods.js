webpackJsonp([33],{0:function(e,o,t){"use strict";var i=t(4),r=t(1),n=t(6),l=t(7),s=t(5),a=t(3),u=t(40),c=t(18),p=t(8);(function(){for(var e=[[7154,8651],[7900,12265]],o=location.href,t=0;t<e.length;t++){var i="goods_id="+e[t][0],r="goods_id="+e[t][1];if(o.indexOf(i)>=0)return o=o.replace(i,r),void s.reload(o)}})();r.prepare({shareInfo:{noDefaultShare:!0,forceShareToWeChatTimeline:!0}},function(){var e="进店逛逛",o="返回店铺",d="立即参团",f="邀请好友参团",g="即将开始",m="抽奖活动暂不支持单独购买",y="活动已经结束了，点击返回上一页",_="该商品是APP专享团商品，请在APP中购买和参团。",h="1",T=0,v={TOP:"1",DETAIL:"2"},I="游客",k=n.shop.logo,S=r.getParameter("mall_id"),D=r.getParameter("goods_id"),b=r.getParameter("status"),w=r.getParameter("group_role"),P=r.getParameter("group_order_id"),G=r.getParameter("like_flag"),N=r.getParameter("rec_from_group")||"",E={},O=[],R="",A=!0,L={},C=!1,M={PNG:"like.png",GIF:"like.gif"},x={PNG:"unlike.png",GIF:"unlike.gif"},q=!1,V=parseFloat(r.getParameter("sp"))||0,U=Math.min(i(window).width(),640),B=function(e){return"http://pinduoduo.b0.upaiyun.com/like/"+e},K=function(e){var o="user/me",t="http://mp.weixin.qq.com/s?__biz=MzIxNzA1NDEyNQ==&mid=401077092&idx=1&sn=b5c3cacd949a29675119eb85c66def50#rd";r.apiRequest("GET",o,null,function(o){return localStorage.getItem(l.LocalStorageKey.UID)||r.saveToLocalStorage(l.LocalStorageKey.UID,parseInt(o.uid,10).toString(36)),o.is_subscribed?void r.call(e):(localStorage.setItem("LASTGOODSID",D),void(location.href=t))},function(){r.call(e)})},Q=0,W=i.Deferred(),F=function(e){var o={before:!1,position:"#goods_details"};r.apiRequest("GET","recommendation?goods_id="+D+"&referrer=goods",null,function(e){t(17)(function(t){t.load(e.list,o),W.resolve()})}),u({slideCell:"#focus",titCell:".hd ul",mainCell:".bd ul",effect:"left",autoPlay:!0,autoPage:!0,switchLoad:"_src",endFun:function(e,o){Q=e}}),$.length>0?Z($):j.resolve(),t(55)(function(e){e.load(".mall_goods",D)}),X(),ee()},Y=null,J=function(n,u){if(null==Y){if(Y=avalon.define({$id:"root",goodsName:n.goodsName,goodsDescription:n.goodsDesc,shareDesc:n.shareDesc,goodsCountry:n.country,goodsWarehouse:n.warehouse,country_img_url:"",isPreSale:n.isPreSale==h,if_lottery_off_goods:!1,if_lucky_result_on:"",if_lottery_result_on:"",if_spike_coming:g,spikeComing:!1,lotteryComing:!1,resultOn:"",gallery:[],marketPrice:n.marketPrice,soldQuantity:0,isOnSale:n.isOnSale,allowedRegions:n.allowedRegions,haitaoVisible:!1,skus:[],skuInfos:[],skuSelectorVisible:!1,localGroups:n.localGroups,groupTypes:n.groupTypes,leftTime:[],groupInfo:{groupID:n.groupTypes[1].groupID,size:n.groupTypes[1].requireNum,price:n.groupTypes[1].price,description:n.groupTypes[1].requireNum+"人团",visible:!1},directBuyInfo:{groupID:n.groupTypes[0].groupID,price:n.groupTypes[0].price,description:"单独购买",visible:!1},hasfreecoupons:!1,hasAssociatedGroup:!1,groupRoleDescription:"",mallButtonText:null==S?e:o,mall:{mallID:u.mallID,name:u.mallName,logo:u.logo,soldQuantity:u.mallSales,canContact:u.canContact},mallService:[{isVisible:!0,type:"包邮",m_class:"mall_detail_1"},{isVisible:!0,type:"7天退换",m_class:"mall_detail_2"},{isVisible:!0,type:"正品保障",m_class:"mall_detail_3"},{isVisible:!1,type:"海关监督",m_class:"mall_detail_4"},{isVisible:!1,type:"进口保税",m_class:"mall_detail_5"},{isVisible:!0,type:"72小时发货",m_class:"mall_detail_6"}],containerPaddingBottom:"46px",lotteryLuckyButtonBGColor:"",isLuckyDraw:n.eventType==l.EVENT_TYPE.LUCKY_DRAW,islike:!1,likeImg:"",goodsBanner:.625*U+"px",goodsVisible:"hidden",isApp:n.isApp,lotteryRule:{},hasLotteryRule:C,go_to_lucky_list:function(){return 3==n.luckyStatus?void s.forward("lottery_list.html?"+r.buildQuery({lucky_id:n.luckyID})):void 0},goodsLike:function(){if(E=localStorage.getItem("LIKEDATA"),E=JSON.parse(E)||{},O=E.id||[],R=E.time,event.stopPropagation(),p.hasAccessToken()){if(!A)return;Y.islike?(A=!1,r.apiRequest("POST","favorite/unlike/"+D,D,function(e){E.time=e,Y.islike=!1,O.splice(O.indexOf(D),1),E.id=O,localStorage.setItem("LIKEDATA",JSON.stringify(E)),Y.likeImg=B(x.PNG),setTimeout(function(){A=!0},1e3)},null)):(A=!1,r.apiRequest("POST","favorite/like/"+D,D,function(e){E.time=e,Y.islike=!0,q?(c.show("已加入收藏,可在您的个人中心查看",{showDuration:1e3,center:!0}),q=!1):c.show("已加入收藏",{showDuration:500,center:!0}),O.push(D),E.id=O,localStorage.setItem("LIKEDATA",JSON.stringify(E)),Y.likeImg=B(M.PNG),setTimeout(function(){A=!0},2e3)},null))}else s.reload("login.html?from="+encodeURIComponent(window.location.href+"&like_flag=true"))},toindex:function(){s.home()},tomessage:function(){r.checkMallCS(Y.mall.mallID,{goodsID:D,go:!0})},gotoMall:function(){null==S?s.forward("mall_page.html?"+r.buildQuery(r.getParameters(),{mall_id:Y.mall.mallID})):s.back()},showGroupRule:function(){s.forward("tuan_rule.html")},groupBuy:function(){if(Y.isOnSale){if("1"==Y.isApp&&!r.isNativePlatform())return void Y.showDownloadNotification();Y.selectedBuyMethodInfo=Y.groupInfo,Y.tryShowSKUSelector(Y.groupTypes[1])||Y.confirmOrder()}},directBuy:function(){if(Y.isOnSale){if("1"==Y.isApp&&!r.isNativePlatform())return void Y.showDownloadNotification();if(Y.isLuckyDraw)return void r.showToast(m);Y.selectedBuyMethodInfo=Y.directBuyInfo,Y.tryShowSKUSelector(Y.groupTypes[0])||Y.confirmOrder()}},groupBuyOrPromptShare:function(){w==l.GroupRole.Member||w==l.GroupRole.Lead?s.forward(s.GroupUrl+"?group_order_id="+P):Y.groupBuy()},tryShowSKUSelector:function(e){return Y.skuInfos.length<=1||!Y.isOnSale?!1:(a.show(),t(65)(function(o){a.hide(),o.load(Y.$model.skuInfos,e,Y.goodsName,function(e,o){Y.confirmOrder(e,o)}),o.show()},function(){a.hide()}),!0)},joinNearbyGroup:function(e){s.forward(s.GroupUrl+"?group_order_id="+e)},confirmOrder:function(e,o){var t=null;if(1==Y.skus.length)t=Y.skus[0];else if(Y.skus.length>1)for(var i=0;i<Y.skus.length;++i)if(Y.skus[i].skuID==e){t=Y.skus[i];break}if(null!=t){var n=Y.selectedBuyMethodInfo.groupID,l={sku_id:t.skuID,group_id:n,goods_id:D,goods_number:o||"1"};null!=P&&(l.group_order_id=P),r.isWeChatPlatform()&&(l.showwxpaytitle="1"),s.forward("order_checkout.html?"+r.buildQuery(l))}},viewGoodsImage:function(){event.stopPropagation(),r.viewImages(Y.gallery[Q],Y.gallery)},showDownloadNotification:function(){event.stopPropagation(),t(27)(function(e){e.load({title:"APP专享团",content:_},function(){e.show()})})}}),p.hasAccessToken()&&(E=localStorage.getItem("LIKEDATA"),E=JSON.parse(E)||{},O=E.id||[],R=E.time,0==R&&(q=!0),O.indexOf(D)>-1?(Y.islike=!0,Y.likeImg=B(M.PNG)):Y.likeImg=B(x.PNG)),G&&!Y.islike){var y=function(){r.apiRequest("GET","favorite/goods",null,function(e){E.time=e.favorite_update_time;for(var o=[],t=0;t<e.goods_list.length;t++)o.push(e.goods_list[t].goods_id);E.id=o,O=E.id,R=E.time,localStorage.setItem("LIKEDATA",JSON.stringify(E)),v.resolve()})},v=i.Deferred();y(),i.when(v).done(function(){Y.goodsLike()})}"0"!=n.luckyID&&n.eventType==l.EVENT_TYPE.LUCKY_DRAW&&(Y.hasLotteryRule&&(Y.lotteryRule=L),n.luckyEndTime<T?(Y.if_lottery_off_goods=!0,"3"==n.luckyStatus?Y.resultOn="on":Y.resultOn="waiting"):n.luckyStartTime>T&&(Y.lotteryComing=!0)),n.eventType==l.EVENT_TYPE.SPIKE&&n.groupTypes[n.groupTypes.length-1].startTime>T&&(Y.spikeComing=!0,Y.if_spike_coming=g),n.eventType==l.EVENT_TYPE.TZMD&&0!=n.freeCoupon.length&&(1==w?Y.hasfreecoupons=!1:Y.hasfreecoupons=!0);var I=[l.GoodsType.IMPORTS,l.GoodsType.OVERSEAS_TRANSSHIP,l.GoodsType.OVERSEAS_DM].indexOf(n.goodsType);I>=0&&(Y.haitaoVisible=!0,Y.mallService[5].isVisible=!1,Y.country_img_url="http://pinduoduo.b0.upaiyun.com/nation/"+Y.goodsCountry+".png",I>0?(Y.goodsCountry=Y.goodsCountry+(n.goodsType==l.GoodsType.OVERSEAS_DM?"直邮":"直供"),Y.goodsWarehouse=Y.goodsWarehouse+"发货",Y.mallService[4].isVisible=!0):(Y.goodsCountry=Y.goodsCountry+"进口",""!=Y.goodsWarehouse&&(Y.goodsWarehouse=Y.goodsWarehouse+"发货"),Y.mallService[3].isVisible=!0)),(Y.isLuckyDraw||Y.isPreSale)&&(Y.mallService[5].isVisible=!1),n.isRefundable||(Y.mallService[1].isVisible=!1);for(var k=(n.groupTypes[1].price,function(e){var o=function(e){return 10>e?"0"+e:e},t=function(){for(var e=0;e<Y.leftTime.length;e++){var t=Math.round((new Date).getTime()/1e3),i=Math.max(Y.leftTime[e].expire-t,0),r=Math.floor(i/60),n=Math.floor(r/60),l=Math.floor(n/24);l%=365,n=o(n%24),r=o(r%60),i=o(Math.floor(i%60)),Y.leftTime[e].leftDays=l,Y.leftTime[e].leftHours=n,Y.leftTime[e].leftMinutes=r,Y.leftTime[e].leftSeconds=i}},i=Math.max(e.expireTime-T,0),r=Math.floor(i/60),n=Math.floor(r/60),l=Math.floor(n/24);l%=365,n=o(n%24),r=o(r%60),i=o(Math.floor(i%60)),Y.leftTime.push({expire:e.expireTime,leftDays:l,leftHours:n,leftMinutes:r,leftSeconds:i}),setInterval(t,1e3)}),N=n.groupTypes[1].requireNum,K=0;K<Y.localGroups.length;K++)Y.localGroups[K].requireNum=N-Y.localGroups[K].usersNum,k(Y.localGroups[K]);Y.gallery=n.topGallery,$=n.detailGallery;var F=n.skus;Y.skuInfos=F;var J=!1;null!=F&&F.length>0&&(Y.soldQuantity=0,F.forEach(function(e){Y.soldQuantity+=parseInt(e.soldQuantity,10)+parseInt(e.initQuantity,10);var o={};o.skuID=e.skuID,o.quantity=parseInt(e.quantity,10),o.thumbURL=e.url,J=J||e.isOnSale&&o.quantity>0,Y.skus.push(o)}),"0"!=n.luckyID&&n.eventType==l.EVENT_TYPE.LUCKY_DRAW&&Y.soldQuantity>1e4&&(Y.soldQuantity="10000+")),Y.groupInfo.visible=!0,Y.selectedBuyMethodInfo=Y.groupInfo,Y.directBuyInfo.visible=!0,Y.isOnSale&&!J&&(Y.isOnSale=!1),Y.isOnSale||(Y.localGroups=[]),b==l.GroupStatus.OnGoing?(Y.hasAssociatedGroup=!0,w==l.GroupRole.Member||w==l.GroupRole.Lead?Y.groupRoleDescription=f:(Y.groupRoleDescription=d,Y.tryShowSKUSelector(Y.groupTypes[1]))):b==l.GroupStatus.Success||b==l.GroupStatus.Failed?(Y.hasAssociatedGroup=!1,Y.tryShowSKUSelector(Y.groupTypes[1])):Y.hasAssociatedGroup=!1,0!=V?i.when(j,W).done(function(){document.getElementsByTagName("body")[0].scrollTop=V,s.replaceURL(r.buildURL({sp:null})),Y.goodsVisible="visible"}):Y.goodsVisible="visible",r.prepareShare({title:Y.goodsName,message:Y.shareDesc,timelineMessage:Y.goodsName,thumbnailURL:n.thumbUrl,shareURL:r.buildURL({mall_id:null,group_order_id:null,status:null,group_role:null}),forceShareToWeChatTimeline:!0}),Y.isOnSale||Y.spikeComing||i(".td2").css("padding-top","0")}},z=function(e){for(var o=0;o<e.length;o++)if(e[o].price<l.ForceContactBound)return!0;return!1},H=function(){var e=function(e,o){var t=function(o){var t="1"==o.chat_enable;return t&&r.addMallCS(e),{mallName:o.mall_name||"",logo:o.logo,mallSales:o.mall_sales||0,canContact:t}};r.apiRequest("GET","mall/"+e+"/info",null,function(e){o(t(e))})},o=function(e){var o=[],t=[];e.gallery=e.gallery||[],e.gallery.sort(function(e,o){return e.priority-o.priority});for(var i=0;i<e.gallery.length;i++){var n=e.gallery[i],s=r.upaiyunCompress(n.url);n.type==v.TOP?o.push(s):n.type==v.DETAIL&&t.push({url:s,width:n.width,height:n.height})}var a=function(e){for(var o=function(e){return e.length<=0?I:e},t=function(e){return e.length<=0?k:e},i=[],r=0;r<e.length;r++){var n=JSON.parse(e[r]||{});!n.group_order_id||parseInt(n.expire_time)<T||i.push({groupOrderID:n.group_order_id,cityName:n.city_name,nickname:o(n.nickname||""),avatar:t(n.avatar||""),requireNum:1,usersNum:n.users_num||1,expireTime:n.expire_time})}return i},u=function(e){e=e||[];for(var o=[],t={},i=0;i<e.length;i++){var r=e[i];"0"==r.is_open||t[r.customer_num]||(o.push({requireNum:r.customer_num,price:parseFloat(r.price/100).toFixed(2),groupID:r.group_id,startTime:parseInt(r.start_time),endTime:parseInt(r.end_time),orderLimit:parseInt(r.order_limit||"1")}),t[r.customer_num]=!0)}return o.sort(function(e,o){return e.requireNum-o.requireNum}),o},c=function(e){for(var o=[],t=0;t<e.length;t++){var i=e[t];"0"!=i.is_onsale&&o.push({skuID:i.sku_id,quantity:parseInt(i.quantity),initQuantity:parseInt(i.init_quantity),isOnSale:!0,soldQuantity:parseInt(i.sold_quantity),specs:i.specs,thumbUrl:i.thumb_url,limitQuantity:parseInt(i.limit_quantity||"1")})}return o},p=u(e.group),d={};return p.length>0&&(d.price=p[p.length-1].price,d.num=p[p.length-1].requireNum),{allowedRegions:e.allowed_region,catID:e.cat_id,country:e.country||"",warehouse:e.warehouse||"",goodsDesc:r.replaceGoodsTpl(e.goods_desc,d),goodsID:e.goods_id,goodsName:r.replaceGoodsTpl(e.goods_name,d),shareDesc:r.replaceGoodsTpl(e.share_desc,d),goodsType:parseInt(e.goods_type)||1,localGroups:a(e.local_group||[]),topGallery:o,detailGallery:t,mallID:e.mall_id,marketPrice:parseFloat(e.market_price/100).toFixed(2),groupTypes:p,skus:c(e.sku),thumbUrl:e.thumb_url,luckyID:e.lucky_id,luckyEndTime:parseInt(e.lucky_end_time),luckyStartTime:parseInt(e.lucky_start_time),luckyStatus:e.lucky_status,eventType:parseInt(e.event_type)||l.EVENT_TYPE.DEFAULT,isOnSale:"0"!=e.is_onsale,isRefundable:"1"==e.is_refundable,freeCoupon:e.free_coupon||[],isApp:e.is_app||"0",isPreSale:e.is_pre_sale}},t=function(e){var o="goods/"+e;return N.length>0&&(o+="&rec_from_group="+N,s.replaceURL(r.buildURL({rec_from_group:null}))),o};r.apiRequest("GET",t(D),null,function(t){T=parseInt(t.server_time);var i=o(t);if(i.groupTypes.length<2)return void r.showAlert(y,function(){s.back()});var n=function(){e(i.mallID,function(e){if("0"!=i.luckyID&&i.eventType==l.EVENT_TYPE.LUCKY_DRAW){var o="lucky_draw/"+D;r.apiRequest("GET",o,null,function(o){if(0==o.length)C=!1;else{C=!0;var t=function(e){return 10>e&&(e="0"+e),e},i=function(e){var o=e.getMonth()+1,i=e.getDate(),r=t(e.getHours()),n=t(e.getMinutes());return o+"月"+i+"日"+r+":"+n},r=new Date(1e3*o.start_time),n=new Date(1e3*o.end_time);L.time="活动时间: "+i(r)+"-"+i(n),L.goodsQuantity="1、活动结束后从组团成功的订单中随机抽取"+o.goods_quantity+"份。",L.couponValue="2、组团成功未抽中者退款+安慰代金券"+o.coupons_value/100+"元！";var l=0;0!=o.shipping_time?(l=new Date(1e3*o.shipping_time),l=l.getMonth()+1+"."+l.getDate()):(n=parseInt(o.end_time)+86400,n=new Date(1e3*n),l=n.getMonth()+1+"."+n.getDate()),L.shippingTime="3、中奖的商品预计"+l+"号发放。"}u(e)},function(){u(e)})}else u(e)})},u=function(e){e.mallID=i.mallID,J(i,e),avalon.scan(document.body),F(),a.hide()};r.isWeChatPlatform()&&z(i.groupTypes)?K(n):n()},function(){setTimeout(function(){s.back()},1e3)})};H();var $=[],j=i.Deferred(),Z=function(e){var o=e||[];o.length<=0||(Y.isOnSale||Y.spikeComing)&&t(56)(function(e){e.load(o),e.show(),j.resolve()})},X=function(){var e=i("#go_top_goods"),o=i("body"),t=parseInt(.5*o.height()),r="-25%",n="115px";e.click(function(){i("html,body").animate({scrollTop:0},300)}),e.css({bottom:r,opacity:0}),i(window).scroll(function(){i(window).scrollTop()<t?e.css({bottom:r,opacity:0}):e.css({bottom:n,opacity:1})})},ee=function(){var e=i("#go_top_close"),o=(i("body"),"0"),r="-25%",n="64px";e.click(function(){s.back()}),e.css({bottom:r,opacity:0}),t(12)(function(){}),i(window).scroll(function(){i(window).scrollTop()!=o?e.css({bottom:n,opacity:1}):e.css({bottom:r,opacity:0})})}})},12:function(e,o,t){t(2),e.exports=function(e,o){t.e(6,function(i){i?o():e(t(15))})}},17:function(e,o,t){t(2),e.exports=function(e,o){t.e(8,function(i){i?o():e(t(30))})}},27:function(e,o,t){t(2),e.exports=function(e,o){t.e(14,function(i){i?o():e(t(48))})}},55:function(e,o,t){t(2),e.exports=function(e,o){t.e(27,function(i){i?o():e(t(307))})}},56:function(e,o,t){t(2),e.exports=function(e,o){t.e(26,function(i){i?o():e(t(308))})}},65:function(e,o,t){t(2),e.exports=function(e,o){t.e(19,function(i){i?o():e(t(318))})}}});