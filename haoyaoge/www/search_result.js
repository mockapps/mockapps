webpackJsonp([50],{0:function(o,t,n){"use strict";var e=n(1),i=n(3),s=(n(6),n(5)),r=n(4);n(86),e.prepare({requireLogin:!1},function(){var o,t={SHOW:"pullUp_show_search",HIDE:"pullUp_hide_search"},a={DEFAULT:"正在玩命的加载...",NO_MORE_RESULTS:"没有更多商品了..."},c={NO_MORE_RESULTS:"loading-text-stop"},l={ON:"loading-spin",OFF:"loading-result-stop"},u={HIDE:{bottom:"-64px",opacity:"0.0"},SHOW:{bottom:"64px",opacity:"1.0"}},d=100,g=30,h=10,p=e.getParameter("search_key")||"",f=e.getParameter("sp")||"0",m=function(m,v){if(!o){o=avalon.define({$id:"root",goodsList:v,currentList:[],total:m,noResult:!1,searchKey:p,content:p,loadingClass:t.SHOW,loadingTextClass:null,loadingTxt:a.DEFAULT,loadingRotateClass:l.ON,waitForGoodsLoading:!1,topButtonBottom:u.HIDE.bottom,topButtonOpacity:u.HIDE.opacity,forwardGoods:function(o){var t=e.buildURL({sp:r(document).scrollTop().toString(),goods_id:o});s.replaceURL(t,function(){s.forward("goods.html?goods_id="+o)})},searchResult:function(t){if(null!=t&&t&&(o.content=t),o.content.trim().length<=0)return void e.showToast("搜索内容不能为空");i.show(),r(".search-box-view-result").blur(),r(".search-box-view-main").blur();var n=o.content.trim();if(null==t||!t){var a=localStorage.getItem("SEARCH_HISTORY");a=a?JSON.parse(a):[];for(var c=!1,l=0;l<a.length;l++)if(n==a[l]){a.splice(l,1),c=!0;break}n.length>0&&(a.unshift(n),o.history=[],o.history=a,localStorage.setItem("SEARCH_HISTORY",JSON.stringify(a)))}s.replaceURL("search_result.html?search_key="+n);var u=encodeURIComponent(n),d="search?q="+u;e.apiRequest("GET",d,null,function(o){var t=o.total,n=[];t>0?(n=o.items,n=L(n),w(t,n),T(),b()):e.apiRequest("GET","v2/ranklist",null,function(o){n=o.goods_list,n=R(n),w(t,n),T(),b()},function(){i.hide()})},function(){i.hide()})},cancelSearch:function(){s.back()},clearSearchBox:function(){o.content="",r(".search-box-view").blur(),n(33)(function(t){t.load("reload",function(){t.register(o.searchResult),t.show()})})},showGoodsLoading:function(){var n=o.currentList.length;n<o.goodsList.length&&!o.waitForGoodsLoading?(o.loadingClass=t.SHOW,o.waitForGoodsLoading=!0,o.loadingTxt=a.DEFAULT,o.loadingRotateClass=l.ON,setTimeout(function(){o.loadingRotateClass=l.OFF,o.waitForGoodsLoading=!1,o.currentList=o.currentList.concat(o.goodsList.slice(n,h+n))},d)):n>=o.goodsList.length&&(o.loadingTextClass=c.NO_MORE_RESULTS,o.loadingClass=t.SHOW,o.loadingTxt=a.NO_MORE_RESULTS,o.loadingRotateClass=l.OFF)},shortenList:function(){o.currentList.length<=g||(o.currentList=o.goodsList.slice(0,g))}}),avalon.scan(),r("#search-result-submit").submit(function(){return o.searchResult(),!1}),o.total<=0&&(o.noResult=!0);var _=g;o.currentList=o.goodsList.slice(0,_);var E=parseFloat(f);E>0&&(document.getElementsByTagName("body")[0].scrollTop=E),s.replaceURL(e.buildURL({sp:null,goods_id:null})),T()}},w=function(t,n){t>0?(o.noResult=!1,o.total=t):(o.noResult=!0,o.searchKey=o.content.trim()),o.goodsList=[],o.goodsList=n,o.currentList=[];var e=g;o.currentList=o.goodsList.slice(0,e),i.hide()},L=function(o){var t=[];return o.forEach(function(o){t.push({goodsID:o.goods_id,thumbURL:o.thumb_url,goodsName:o.goods_name,groupDesc:o.customer_num+"人团",price:(o.price/100).toFixed(2)})}),t},R=function(o){var t=[];return o.forEach(function(o){t.push({goodsID:o.goods_id,thumbURL:o.thumb_url,goodsName:o.goods_name,groupDesc:o.group.customer_num+"人团",price:(o.group.price/100).toFixed(2)})}),t},v=function(){var o=encodeURIComponent(p),t="search?q="+o;e.apiRequest("GET",t,null,function(o){var t=o.total,n=[];t>0?(n=o.items,n=L(n),m(t,n),b(),i.hide()):e.apiRequest("GET","v2/ranklist",null,function(o){n=o.goods_list,n=R(n),m(t,n),b(),i.hide()},function(){i.hide()})},function(){i.hide()})},T=function(){for(var t=r(window).scrollTop(),n=r(window).height(),e=Math.max(t-n,0),i=t+2*n,s=document.querySelectorAll(".search-result-goods")||[],a=0;a<s.length;a++){var c=s[a].offsetTop;if(c>=e&&i>=c){var l=s[a].getElementsByTagName("img")[0];l&&l.dataset.url&&l.src!=l.dataset.url&&(l.src=l.dataset.url)}}O(),E()&&o.showGoodsLoading(),o.currentList.length>0&&_()&&o.shortenList()},_=function(){return r(window).scrollTop()<2*r(window).height()},E=function(){return r(window).scrollTop()+2*r(window).height()>r("#load_more").offset().top},O=function(){var t=2*r(window).height();o.topButtonBottom=u.HIDE.bottom,o.topButtonOpacity=u.HIDE.opacity,r(window).scrollTop()>=t&&(o.topButtonBottom=u.SHOW.bottom,o.topButtonOpacity=u.SHOW.opacity)},b=function(){var o=r(".go-top");o.unbind("click"),o.click(function(){event&&event.preventDefault(),document.getElementsByTagName("body")[0].scrollTop=0}),r(window).bind("scroll",T);var t=r(window).width()>640?640:r(window).width(),n=t-110;r(".search-box-view-main").css("width",n)};v()})},33:function(o,t,n){n(2),o.exports=function(o,t){n.e(13,function(e){e?t():o(n(51))})}},86:function(o,t){}});