webpackJsonp([35],{0:function(n,e,t){"use strict";var o=t(4),i=t(1),u=t(3),r=t(7),a=t(6),s=t(13),c=t(11);i.prepare({requireLogin:!1,regEvents:{onSceneReturn:function(n){n=n||{},n.url&&Navigation.reload(n.url)}}},function(){var n={DOUBLE_12:{type:"double_12",imgUrl:"http://pinduoduo.b0.upaiyun.com/test/double_12_haitao_banner_new.jpg",forwardUrl:"",show:!1}},e=null,l=function(){var n=function(n){n=n||[];for(var e=[],t=0;t<n.length;t++){var o=n[t];e.push({subjectID:parseInt(o.subject_id)||0,imgUrl:o.home_banner})}return e},e=function(n){n=n||[];for(var e=[],t=0;t<n.length;t++){var o=n[t];e.push({forwardUrl:"subject.html?subject_id="+o.subject_id+"&referrer=haitao",name:o.subject,imgUrl:o.home_banner,show:!0})}return e},t="v2/haitaov2?page=1&size=200";i.apiRequest("GET",t,null,function(t){var o=t,i=n(t.promotion_list),u=e(t.country_list);f(o,i,u)},function(){u.hide()})},f=function(n,e,o){h(e),t(32)(function(n){n.load(o,function(){n.show()})}),t(16)(function(e){e.load(n,function(n){n&&(e.show(),d.goodsListReady("add"))})}),c.hasNewMsg(),avalon.scan(document.getElementById("index-content"))},d=avalon.define({$id:"root",goodsList:[],goodsComplete:!1,bannerComplete:!1,bannerHeight:""+.546875*Math.min(o(window).width(),640)+"px",show:"hidden",goodsListReady:function(n){"add"==n&&(d.goodsComplete=!0),("banner"!=n||d.goodsComplete)&&d.bannerComplete&&(d.goodsComplete=!0,e&&e.play(),u.hide(),d.show="visible")},getHaitaoCoupon:function(){var n="coupon_batch/take",e={batch_ids:r.BLACK_FRIDAY_DATA.COUPON_BATCH_IDS};2!=a.shop.shopID&&(e.batch_ids=r.BLACK_FRIDAY_DATA.COUPON_BATCH_IDS_TEST),i.apiRequest("POST",n,e,function(n){1==n.result&&i.showAlert("优惠券已成功领取，快去买买买！")},function(n){i.showAlert(s.messageFromCode(n))},null,null,!0)},clickDouble12:function(){u.show();var n=r.DOUBLE_12_DATA.COUPON_BATCH_IDS;2!=a.shop.shopID&&(n=r.DOUBLE_12_DATA.COUPON_BATCH_IDS_TEST);var e=function(){for(var e="coupon_batch/is_taken",t=0;t<n.length;t++)e+=(t>0?"&":"?")+"batch_ids[]="+n[t];return e};i.apiRequest("GET",e(),null,function(n){u.hide(),1!=n.result?Navigation.forward("coupon_event.html"):i.showToast(s.CouponTaken.message)},function(){u.hide()})}}),h=function(o){var i=[];null!=n.DOUBLE_12&&n.DOUBLE_12.show&&i.push(n.DOUBLE_12);for(var u=0;u<o.length;u++){var r=o[u];r.subjectID>0&&i.push({type:"subject_"+r.subjectID,imgUrl:r.imgUrl,forwardUrl:"subject.html?subject_id="+r.subjectID+"&referrer=haitao",show:!0,isInput:!1})}d.bannerComplete=!0,d.goodsListReady("banner"),t(20)(function(n){e=n,e.load(i,d.bannerHeight,function(n){n&&e.show()})})};l(),i.changeTitle("海淘专区"),t(12)(function(){})})},11:function(n,e,t){var o=t(1),i=t(6),u=t(8);t(10);n.exports=function(){var n=3e4,e=1,t={Open:0,Close:1,Authentication:2,Message:3},r=null,a=0,s={},c={},l=[],f=0,d=!1,h=void 0!==window.WebSocket,p=function(){return null!=r&&r.readyState==WebSocket.OPEN},g=function(){p()||null!=r&&r.readyState==WebSocket.CONNECTING||!h||(r=new WebSocket(i.pushDomain+"?"+o.buildQuery({access_token:u.getAccessToken(),role:"user"})),r.onopen=function(){setTimeout(function(){m(),_(t.Open)},50)},r.onclose=function(){setTimeout(function(){d=!1,_(t.Close)},50)},r.onerror=function(n){},r.onmessage=function(n){if(null!=n&&null!=n.data){var e=JSON.parse(n.data);if(null!=e){var o=e.response,i="ok"===e.result;if(!i&&null!=e.result,"auth"==o)return i&&(d=!0),_(t.Authentication,i);var u=e.request_id;if(null!=u){var r=c[u];null!=r&&setTimeout(function(){r(e)},50)}_(t.Message,e)}}})},v=function(n,e){if(null==e)return null;var t=a++;return s[t]={type:n,handler:e},t},_=function(n){for(var e=[],t=1;t<arguments.length;++t)e.push(arguments[t]);for(var o in s){var i=s[o];i.type==n&&setTimeout(function(){i.handler.apply(null,e)},50)}},m=function(n){if(h){var t=null;return"object"==typeof n&&(t=e++,n.request_id=t,l.push(n)),p()?(l.forEach(function(n){r.send(JSON.stringify(n))}),l=[]):g(),t}};return{isOpen:p,isSupport:h,hasAuthenticated:function(){return h?d:!1},onOpen:function(n){return v(t.Open,n)},onClose:function(n){return v(t.Close,n)},onAuthenticationResult:function(n){return h?v(t.Authentication,n):void 0},onMessage:function(n){return h?v(t.Message,n):void 0},unregister:function(n){delete s[n]},keepAlive:function(){if(h)if(p()){var e=Date.now();e-f>=n&&(m({cmd:"heartbeat"}),f=e)}else g()},send:function(n){h&&m(n)},request:function(n,e){if(h){var t=m(n);return null==t||null==e?t:void(c[t]=e)}},hasNewMsg:function(n,e){if(h&&u.hasAccessToken()){var t=JSON.parse(localStorage.getItem("LastPersonalMsg"))||{},i=t.key||0,r=t.time||0;if(0==i||n){var a=Date.now().toString(),s={key:i,time:r};if(3e4>a-r&&!n)return s.time=a,void localStorage.setItem("LastPersonalMsg",JSON.stringify(s));var l=0,f=m({cmd:"latest_conversations",page:1,size:20});c[f]=function(n){for(var t=n.conversations,i=document.querySelector("#footer_personal i"),u=0;u<t.length;u++)"read"!=t[u].status&&l++;null!=i&&0!=l&&i.classList.add("fb-badge1"),s.key=l,s.time=a,localStorage.setItem("LastPersonalMsg",JSON.stringify(s)),null!=e&&o.call(e,l)}}}},alertNotSupport:function(n){h||o.showAlert("您的系统版本不支持这个功能(Android系统版本至少为4.3)",function(){o.call(n)})}}}()},12:function(n,e,t){t(2),n.exports=function(n,e){t.e(6,function(o){o?e():n(t(15))})}},16:function(n,e,t){t(2),n.exports=function(n,e){t.e(9,function(o){o?e():n(t(29))})}},20:function(n,e,t){t(2),n.exports=function(n,e){t.e(10,function(o){o?e():n(t(42))})}},32:function(n,e,t){t(2),n.exports=function(n,e){t.e(12,function(o){o?e():n(t(50))})}}});