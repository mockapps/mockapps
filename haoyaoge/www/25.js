webpackJsonp([25],{309:function(o,t,i){var e=i(4),s=i(1),n=i(7),d=i(5),a=i(8),l=i(18),r=null!=a.getAccessToken();o.exports=function(){"use strict";var o=i(335),t={HIDE:{bottom:-parseInt(.25*e(window).height())+"px",opacity:"0.0"},SHOW:{bottom:"64px",opacity:"1.0"}},a={},c={},g=null,u={},m={},p="goods_grid",h=p,f={DEFAULT:"正在玩命的加载...",NO_MORE_GOODS:"没有更多的商品了..."},v=100,_=8,L=10,w=3,T=1,I=!1,D={},b=null,y={},x=[],O="",S=!0,k=!1,E=function(){null==D[h]&&(D[h]=avalon.define({$id:h,visible:!1,goodsList:[],currentList:[],topButtonBottom:t.HIDE.bottom,topButtonOpacity:t.HIDE.opacity,imgHeight:""+.46875*(Math.min(e(window).width(),640)-22)+"px",isLoading:!1,noMoreLoading:!1,loadingTxt:f.DEFAULT,waitForGoodsLoading:!1,goTopClass:"go_top_"+h,shortenDoing:!1,imgLoadingClass:"imgLoading_"+h,isReady:!1,show:function(){D[h].visible=!0,U()},hide:function(){D[h].visible=!1},goodsListReady:function(){D[h].isReady||(D[h].isReady=!0,s.call(g,!0),g=null)},selectGoods:function(o){if(o){var t=m.notRecordScroll?{}:{sp:e(document).scrollTop().toString(),goods_id:o},i=s.buildURL(t);d.replaceURL(i,function(){var t="goods.html?goods_id="+o;m.mallID&&(t+="&mall_id="+m.mallID),d.forward(t)})}s.call(m.selectGoods)},isSoldOut:function(o){return o!=n.SkuStatus.OnSale},showGoodsLoading:function(){D[h].isLoading=!0;var o=D[h].currentList.length;o<D[h].goodsList.length&&!D[h].waitForGoodsLoading?(D[h].waitForGoodsLoading=!0,D[h].loadingTxt=f.DEFAULT,setTimeout(function(){D[h].waitForGoodsLoading=!1,D[h].currentList=D[h].currentList.concat(D[h].goodsList.slice(o,L+o)),D[h].isLoading=!1},v)):o>=D[h].goodsList.length&&(D[h].loadingTxt=f.NO_MORE_GOODS,D[h].noMoreLoading=!0)},shortenList:function(){D[h].currentList.length<=_||(D[h].currentList=D[h].goodsList.slice(0,_))},goodsLike:function(o){if(event.stopPropagation(),r){if(!S)return;o.islike?(S=!1,s.apiRequest("POST","favorite/unlike/"+o.goodsID,o.goodsID,function(t){y.time=t,o.islike=!1,x.splice(x.indexOf(o.goodsID),1),y.id=x,localStorage.setItem("LIKEDATA",JSON.stringify(y)),setTimeout(function(){S=!0},500)},null)):(S=!1,s.apiRequest("POST","favorite/like/"+o.goodsID,o.goodsID,function(t){y.time=t,o.islike=!0,x.push(o.goodsID),y.id=x,localStorage.setItem("LIKEDATA",JSON.stringify(y)),k?(l.show("已加入收藏,可在您的个人中心查看",{showDuration:1e3,center:!0}),k=!1):l.show("已加入收藏",{showDuration:500,center:!0}),setTimeout(function(){S=!0},1e3)},null))}else{var t=encodeURIComponent("goods_id="+o.goodsID+"&like_flag=true");d.forward("login.html?from=goods.html?"+t)}}}))},B=function(o,t){if(null!=D[h]){D[h].goodsList=[];for(var i=[],e=s.isNativePlatform(),n=0;n<o.length;n++)if(e||"1"!=o[n].is_app){var d=o[n];d.goods_id==b.goodsID&&(b.itemIndex=n);try{d.list_desc=JSON.parse(d.list_desc)}catch(a){d.list_desc=[]}for(var l=0;l<d.list_desc.length;l++)0==d.list_desc[l].replace(/\s/g,"").length&&(d.list_desc[l]="");var r=x.indexOf(d.goods_id)<0?!1:!0,c=(d.group.price/100).toFixed(2),c=c.toString(),g=c.split(".")[0],u="."+c.split(".")[1];c.length>=7&&(u=""),i.push({goodsID:d.goods_id,imgUrl:s.upaiyunCompress(d.thumb_url),goodsName:d.goods_name,marketPrice:(d.market_price/100).toFixed(2),salePriceHeader:g,salePriceFooter:u,eventDesc:d.group.customer_num+"人团",islike:r})}D[h].goodsList=i;var m=_;!R()&&b.currentID==h&&b.itemIndex>=0&&(m=b.itemIndex+L),D[h].currentList=D[h].goodsList.slice(0,m),D[h].goodsList.length<=_&&(D[h].loadingTxt="",D[h].noMoreLoading=!0)}},R=function(){var o=b.sp-e(window).height();return o<=e(document).scrollTop()},N=function(o,t){B(o,t),0==o.length&&D[h].goodsListReady()},A=function(t,i,n,d){function l(){y=localStorage.getItem("LIKEDATA"),y=JSON.parse(y)||{},x=y.id||[],O=y.time,O!=v?(O=v,y.time=v,s.apiRequest("GET","favorite/goods",null,function(o){var t=[];o=o.goods_list;for(var i=0;i<o.length;i++)t.push(o[i].goods_id);x=t,y.id=t,localStorage.setItem("LIKEDATA",JSON.stringify(y)),w.resolve()})):w.resolve()}var f=t.goods_list||[],v=t.favorite_update_time;if(0==v&&(k=!0),m=n||{},h=m.id||p,null==b&&(b={currentID:h,sp:parseFloat(s.getParameter("sp")||0),itemIndex:-1,goodsID:s.getParameter("goods_id")}),I=m.isIndex||!1,I||(_=L),null==a[h]&&(a[h]=s.createNodeFromHTML(s.format(o,h))),g=i,u.goodsList=f,E(),r){var w=e.Deferred();l(),e.when(w).done(function(){N(f,d)})}else s.saveToLocalStorage("LIKEDATA",null),N(f,d);c[h]?s.call(g,!0):(c[h]=!0,document.getElementById(h).appendChild(a[h]),avalon.scan(a[h]))},F=function(){return null!=e("#load_more")&&e("#load_more").height()?e(window).scrollTop()+2*e(window).height()>e("#load_more").height():!1},G=function(){return e(window).scrollTop()<e(window).height()},H=function(){var o=2*e(window).height();for(var i in D)D[i].topButtonBottom=t.HIDE.bottom,D[i].topButtonOpacity=t.HIDE.opacity;e(window).scrollTop()>=o&&(D[h].topButtonBottom=t.SHOW.bottom,D[h].topButtonOpacity=t.SHOW.opacity)},P=function(){for(var o=e(window).scrollTop(),t=e(window).height(),i=Math.max(o-t,0),s=o+2*t,n=document.querySelectorAll(".tuan_grid")||[],d=0;d<n.length;d++){var a=n[d].offsetTop;if(a>=i&&s>=a){var l=n[d].getElementsByTagName("img")[0];l&&l.dataset.url&&l.src!=l.dataset.url&&(l.src=l.dataset.url)}}H(),F()&&D[h].showGoodsLoading(),D[h].currentList.length>0&&G()&&D[h].shortenList()},U=function(){var o=e(".go-top");o.unbind("click"),o.click(function(){event&&event.preventDefault(),document.getElementsByTagName("body")[0].scrollTop=0}),e(window).bind("scroll",P)},M={};e.fn.scrollLoadList=function(o){M[h]||(M[h]=0),M[h]++;var t={attr:"data-url"},i=e.extend({},t,o||{});i.cache=[],i.cnt=M[h],e(this).each(function(){var o=this.nodeName.toLowerCase(),t=e(this).attr(i.attr);if(t&&!(e(this).offset().top<=0)){var s={obj:e(this),tag:o,url:t,showed:!1};i.cache.push(s)}});var s=function(){if(i.cnt==M[h]){var o=e(window).scrollTop()-e(window).height();0>=o&&b.itemIndex<_;var t=o+2*e(window).height(),s=-1;return e.each(i.cache,function(i,e){var n=e.obj,d=e.tag,a=e.url,l=e.showed,r=n.offset().top,c=r+n.height();(r>o&&t>r||c>o&&t>c)&&i<D[h].currentList.length&&(n&&!l&&("img"===d?n.attr("src",a):n.load(a),e.showed=!0),s=i)}),o>0&&(s+w>=D[h].currentList.length||e(document).height()+T<=e(document).scrollTop()+e(window).height())&&D[h].showGoodsLoading(),!1}};e(window).unbind("scroll"),e(window).bind("scroll",function(){s(),H()}),s()};var C=function(o){null!=D[h]&&D[h].show(),null!=b&&(b.sp>0&&b.currentID==h?(document.getElementsByTagName("body")[0].scrollTop=b.sp,b.sp=0,b.itemIndex=-1):(document.getElementsByTagName("body")[0].scrollTop=0,P()),d.replaceURL(s.buildURL({sp:null,goods_id:null}))),setTimeout(function(){s.call(o)},100)},J=function(){null!=D[h]&&D[h].hide()};return{load:A,show:C,hide:J}}()},335:function(o,t){o.exports='<div ms-controller="{0}">\n<div class="goods_grid_wrapper" ms-visible="visible">\n    <div class="goods_grid_one" ms-repeat-item="currentList" ms-click="selectGoods(item.goodsID)" data-repeat-rendered="goodsListReady">\n        <div class="tuan_grid">\n            <div class="grid_good_img" ms-css-height="imgHeight">\n                <img src="http://pinduoduo.b0.upaiyun.com/test/default_square.jpg"  ms-data-url="item.imgUrl" ms-class="{{imgLoadingClass}}">\n            </div>\n            <div class="tuan_grid_info">\n                <p class="tuan_grid_name" ms-text="item.goodsName"></p>\n            </div>\n            <div class="tuan_grid_price">\n                <span ms-text="item.eventDesc"></span>\n                <b class="grid_price_icon">￥</b><b class="grid_price_header">{{item.salePriceHeader}}</b><b class="grid_price_footer">{{item.salePriceFooter}}</b>\n                <div class="goods_grid_like" ms-class-liked="item.islike == true">\n                    <div ms-click="goodsLike(item)" class="like_click_grid"></div>\n                </div>\n            </div>   \n        </div>\n    </div>\n    <div class="grid_load_wrap" id="load_more">\n        <div class="grid_load" >\n            <div class="center" id="center_pullup">\n                <span ms-if="!noMoreLoading"><img class="img_rotate loading-spin" src="assets/img/pull_loading-1e493b5612.png"/></span>\n                <span class="grid_load_text" ms-text="loadingTxt"></span>\n            </div>\n        </div>\n    </div>\n</div>\n<div class="go-top" ms-class="{{goTopClass}}" ms-css-bottom="topButtonBottom" ms-css-opacity="topButtonOpacity"><span>顶部</span></div>\n</div>\n'}});