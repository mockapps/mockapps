webpackJsonp([34],{0:function(e,t,n){"use strict";n(84);var o=n(4),a=n(1),r=n(7),i=n(5),s=n(3),l=n(24),d=n(9),u=n(10),c=n(18);a.isWeChatPlatform()&&(location.hash="#mp.weixin.qq.com"),a.prepare({requireLogin:!0,regEvents:{onSceneReturn:function(e){e=e||{},i.reload(e.url)}}},function(){var e="确定取消订单？",t="是否确认收货？",m="亲，确认延长收货订单？(每笔订单只能延长一次哦~)",p="亲，您已经延长过收货时间哦~",g="亲，距离结束时间3天才可以申请哦~",f="延长收货成功!",h="延长收货失败!",_="商家电话正在录入中",b="当前版本的客户端不支持该功能,请更新客户端",S="已确认，待抽奖",y="售后投诉",v="售后处理中",I="处理结果",E="2月5日~2月13日反馈的售后投诉问题，我们将在2月20日前处理完毕",C="LastPaymentType",w=parseFloat(a.getParameter("sp"))||0,T={0:{tag:"等待买家付款",msg:""},1:{tag:"组团还未成功",msg:"让小伙伴们都来组团吧~"},2:{tag:"组团成功",msg:"等待卖家发货"},3:{tag:"卖家已发货",msg:""},4:{tag:"交易成功",msg:""},5:{tag:"订单已取消",msg:""},10:{tag:"组团失败",msg:""}},O=a.getParameter("order_sn"),D=a.getParameter("type")||r.OrderType.All,P=function(s,d){if(null!=s){var P=avalon.define({$id:"root",userInteractionEnabled:!0,orderSN:s.order_sn||"",associatedGroupOrderID:null,shipmentStatus:r.ShipmentStatus.Unshipped,status:r.OrderCombinedStatus.Uncomfirmed,statusDescription:"",complaintStatus:"",showComplaint:!1,complaintHint:y,orderAmount:(s.order_amount/100).toFixed(2),paymentProvider:function(e){return["6","9"].indexOf(e)>=0?"支付宝":"微信"}(s.app_id||""),address:s.city_name+" "+s.district_name+" "+s.shipping_address,receiver:s.receive_name||"",mobile:s.mobile||"",orderTime:s.order_time||"",confirmTime:s.confirm_time||"0",shippingTime:s.shipping_time||"0",receiveTime:s.receive_time||"0",couponDescription:null,shipmentProvider:(s.shipping||{}).shipping_name||"",trackingNumber:s.tracking_number||"",rateStatus:s.rate_status||"0",canExtendReception:{time:!1,hasExtended:!1},extentionLastTime:"",mall:{id:"",name:"",logo:"",phone:"",canContact:!1},goods:{goodsID:null,name:"",number:"",price:"",thumbnailURL:""},bannerInfo:{title:{tag:"",msg:""},statusFlow:[]},recommendList:[],weChatPayVisible:a.isWeChatPayAvailable(),aliPayVisible:a.isAliPayAvailable(),paymentType:d,showGoodsDetails:function(){null==P.goods.goodsID||P.goods.goodsID.length<=0||i.forward("goods.html?goods_id="+P.goods.goodsID)},showGroupDetails:function(){event.stopPropagation(),null==P.associatedGroupOrderID||P.associatedGroupOrderID.length<=0||i.forward(i.GroupUrl+"?group_order_id="+P.associatedGroupOrderID)},selectPaymentType:function(e){P.paymentType=e},cancelOrder:function(){if(P.userInteractionEnabled){P.setUserInteractionEnabled_(!1);var t=function(){a.apiRequest("POST","order/"+P.orderSN+"/cancel",null,function(){i.back("orders.html")},function(){i.back("orders.html")})};a.showConfirm(e,t,function(){P.setUserInteractionEnabled_(!0)})}},payOrder:function(){P.userInteractionEnabled&&null!=P.paymentType&&(a.isNativePlatform()||localStorage.setItem(C,P.paymentType.toString()),P.setUserInteractionEnabled_(!1),payment.pay(P.paymentType,P.orderSN,P.goods.name,function(e){P.setUserInteractionEnabled_(!0)},!0))},showExpress:function(){P.userInteractionEnabled&&(P.setUserInteractionEnabled_(!1),n(21)(function(e){P.setUserInteractionEnabled_(!0),e.load(P.orderSN,{shippingName:P.shipmentProvider,trackingNumber:P.trackingNumber}),e.show()},function(){P.setUserInteractionEnabled_(!0),a.showToast(Error.messageFromCode(0))}))},confirmShipment:function(){if(P.userInteractionEnabled){P.setUserInteractionEnabled_(!1);var e=function(){a.apiRequest("POST","order/"+P.orderSN+"/received",null,function(e){P.setUserInteractionEnabled_(!0);if(P.status=r.OrderCombinedStatus.Received,P.rateStatus=r.rateStatus.rateEnable,localStorage.getItem("ORDER_INFO_CACHES")){for(var t=JSON.parse(localStorage.getItem("ORDER_INFO_CACHES")),o=0;o<t.length;o++)t[o].order_sn==O&&(t[o].shipping_status=r.ShipmentStatus.Received,t[o].rate_status=r.rateStatus.rateEnable,t[o].order_combined_status=r.OrderCombinedStatus.Received,t[o].order_status_desc=r.OrderDesc.Received,D==r.OrderType.Collecting&&t.splice(o,1));localStorage.setItem("ORDER_INFO_CACHES",JSON.stringify(t))}if(a.isNativePlatform()){var s=e.share_code||"";n(31)(function(e){e.load(O,P.goods.goodsID,P.goods.thumbnailURL,s,null,null,null,null,P)})}else i.forward("deal_made.html?"+a.buildQuery({order_sn:O,goods_id:P.goods.goodsID,thumb_url:P.goods.thumbnailURL,type:D,from:"order"}))},function(){P.setUserInteractionEnabled_(!0)})},o=function(){i.forward("download.html?src=weixin&campaign=gzh&cid=querenshouhuo")},s=function(){P.setUserInteractionEnabled_(!0)};a.isNativePlatform()?a.showConfirm(t,e,function(){P.setUserInteractionEnabled_(!0)}):a.showJSAlert(r.AlertType.Confirm.ConfirmShipment,o,e,s)}},setUserInteractionEnabled_:function(e){P.userInteractionEnabled=e;for(var t=e?"1.0":"0.5",n=document.querySelectorAll(".action_button"),o=0;o<n.length;++o)n[o].style.opacity=t},extendReception:function(){var e=function(){return P.canExtendReception.hasExtended?void a.showToast(p):P.canExtendReception.time?void a.apiRequest("POST","order/"+O+"/extention",null,function(e){a.showToast(f),i.reload()},function(){a.showToast(h)}):void a.showToast(g)};a.showConfirm(m,e,function(){})},contact:function(){a.checkMallCS(P.mall.id,{orderSN:P.orderSN,go:!0})},phoneCall:function(){""==P.mall.phone?a.showToast(_):null==P.mall.phone&&a.showToast(b)},getComplaintStatus:function(){var e=s.complain;return 0==e.length?"":("0"==e[0].status||"1"==e[0].status?P.complaintHint=v:"2"==e[0].status&&(P.complaintHint=I),e[0].status)},showAfterSalesComplaint:function(){if(event.stopPropagation(),"0"==P.complaintStatus||"1"==P.complaintStatus)return void c.show(E,{showDuration:1500,center:!0});if("2"==P.complaintStatus&&i.forward("complaint_result.html?order_sn="+P.orderSN),0==P.complaintStatus.length){var e=a.getAppVersion();a.isNativePlatform()&&e.length>0&&"1.1.2">=e?i.forward("complaint_guide.html"):i.forward("complaint.html?order_sn="+P.orderSN)}},forwardEvaluate:function(){var e=a.buildQuery({order_sn:O,thumb_url:P.goods.thumbnailURL,goods_id:P.goods.goodsID,type:D});i.forward("comments.html?"+e)}});null==P.paymentType&&(P.weChatPayVisible?P.paymentType=r.PaymentType.WeChat:P.aliPayVisible&&(P.paymentType=r.PaymentType.AliPay));var R=s.timestamp||Date.parse(new Date),x=s.group_order_id,N=s.order_status,U=s.pay_status,A=s.shipping_status,L=R-P.orderTime>86400;null!=x&&x.length>0&&U>=r.PaymentStatus.Payed&&(P.associatedGroupOrderID=x),P.shipmentStatus=A,P.status=l.getOrderCombinedStatus(N,U,A);var G=s.mall;if(null!=G){P.mall.id=G.id||"0",P.mall.name=G.mall_name||"",P.mall.logo=G.logo||"",P.mall.phone=G.company_phone||"";var q="1"==G.chat_enable;q&&a.addMallCS(P.mall.id),P.mall.canContact=q}var k=s.order_goods||[],F=k.length>0?k[0]:null;null!=F&&(P.goods.goodsID=F.goods_id,P.goods.name=F.goods_name||"",P.goods.number=F.goods_number||"",P.goods.price=(F.goods_price/100).toFixed(2),P.goods.thumbnailURL=F.thumb_url||"",P.goods.spec=F.spec||"",P.goods.goodsType=parseInt((F.goods||{}).goods_type||0),P.goods.goodsNumber=F.goods_number||"1");var V=s.coupons;if(V.length>0&&(V=V[0]),null!=V&&V.coupon_batch){var H=V.coupon_batch.batch_name;null!=H&&H.length>0&&(P.couponDescription=H)}"团长免单券"==P.couponDescription&&P.status==r.OrderCombinedStatus.Unconfirmed&&L&&(P.status=r.OrderCombinedStatus.Expired),P.status==r.OrderCombinedStatus.Shipping&&(P.canExtendReception=function(){var e=P.goods.goodsType==r.GoodsType.OVERSEAS_DM?2332800:1036800,t=parseInt(s.shipping_time)+e,n=t+259200,o=s.order_extention||{},a=o.extention_time||"0";return P.extentionLastTime=function(){var e=Math.max(n+parseInt(a)-R,0),t=parseInt(e/3600),o=t%24,r=Math.floor(t/24);return"还剩余"+r+"天"+o+"时自动确认"}(),{time:R>t&&n>R,hasExtended:"0"!=a}}()),P.statusDescription=l.getOrderCombinedStatusDescription(P.status);var J=F.lucky_draw||null;null!=J&&J.status<3&&P.status==r.OrderCombinedStatus.Confirmed&&(P.statusDescription=S),P.bannerInfo=function(){var e={};return e.title=T[P.status]||{tag:P.statusDescription,msg:""},e.statusFlow=[],P.status==r.OrderCombinedStatus.Shipping&&(e.title.msg=P.extentionLastTime||""),e}(),function(){var e=o("#phone_call");if(u.Current==u.Android&&a.getAppVersion()<"1.0.6")return void(P.mall.phone=null);if(""!=P.mall.phone){var t="tel:"+P.mall.phone;e.attr("href",t)}}();var M=o.Deferred();if(P.status!=r.PaymentStatus.Unpayed){var W={before:!1,position:".order-order_detail"};a.apiRequest("GET","recommendation?goods_id="+P.goods.goodsID+"&referrer=order",null,function(e){n(17)(function(t){t.load(e.list,W),M.resolve()})})}M.done(function(){document.getElementsByTagName("body")[0].scrollTop=w,i.replaceURL(a.buildURL({sp:null}))}),P.status==r.OrderCombinedStatus.Shipping||P.status==r.OrderCombinedStatus.Received?P.showComplaint=!0:P.showComplaint=!1,P.complaintStatus=P.getComplaintStatus(),avalon.scan(document.body)}},R=function(){a.apiRequest("GET","order/"+O,null,function(e){var t=function(t){s.hide(),e.shipping=e.shipping||{},P(e,t)};if(a.isNativePlatform())d.callNative("JSPay","getLastPayType",null,function(e){t(e.paytype)},function(){t()});else{var n=localStorage.getItem(C);null!=n&&(n=parseInt(n,10)),t(n)}},function(){setTimeout(function(){i.reload("orders.html")},1e3)})};n(14)(function(e){window.payment=e,R()},function(){location.reload()})})},14:function(e,t,n){n(2),e.exports=function(e,t){n.e(7,function(o){o?t():e(n(23))})}},17:function(e,t,n){n(2),e.exports=function(e,t){n.e(8,function(o){o?t():e(n(30))})}},21:function(e,t,n){n(2),e.exports=function(e,t){n.e(11,function(o){o?t():e(n(43))})}},31:function(e,t,n){n(2),e.exports=function(e,t){n.e(15,function(o){o?t():e(n(49))})}},84:function(e,t){}});