webpackJsonp([40],{0:function(e,n,t){"use strict";var o=t(4),i=t(1),u=(t(5),t(3)),r=t(11);t(8);i.prepare({requireLogin:!1},function(){var e=isNaN(i.getParameter("subject_id"))?null:i.getParameter("subject_id");if(null!=e){var n=function(){var n={},t=[],r=o.Deferred(),a=function(){var t="subject/"+e;i.apiRequest("GET",t,null,function(e){n={subjectName:e.subject,subjectDesc:e.desc,imgUrl:e.banner||""},r.resolve()},function(){u.hide()})},c=o.Deferred(),l=function(){var n="v2/subject/"+e+"/goods";i.apiRequest("GET",n,null,function(e){t=e,c.resolve()},function(){u.hide()})};a(),l(),o.when(r,c).done(function(){u.hide(),s(t,n)}).fail(function(){u.hide()})},s=function(e,n){c(n),t(16)(function(n){n.load(e,function(e){e&&n.show(a.goodsListReady("add"))})},function(){}),r.hasNewMsg(),avalon.scan(document.getElementById("index-content")),e.length<=0&&u.hide()},a=null,c=function(e){null==a&&(a=avalon.define({$id:"root",subjectInfo:{},showHeadImg:!1,show:"hidden",goodsListReady:function(){u.hide(),a.show="visible"}}),a.subjectInfo=e,a.showHeadImg=e.imgUrl.length>0,i.changeTitle(a.subjectInfo.subjectName))};n(),t(12)(function(){})}})},11:function(e,n,t){var o=t(1),i=t(6),u=t(8);t(10);e.exports=function(){var e=3e4,n=1,t={Open:0,Close:1,Authentication:2,Message:3},r=null,s=0,a={},c={},l=[],f=0,d=!1,g=void 0!==window.WebSocket,v=function(){return null!=r&&r.readyState==WebSocket.OPEN},h=function(){v()||null!=r&&r.readyState==WebSocket.CONNECTING||!g||(r=new WebSocket(i.pushDomain+"?"+o.buildQuery({access_token:u.getAccessToken(),role:"user"})),r.onopen=function(){setTimeout(function(){b(),m(t.Open)},50)},r.onclose=function(){setTimeout(function(){d=!1,m(t.Close)},50)},r.onerror=function(e){},r.onmessage=function(e){if(null!=e&&null!=e.data){var n=JSON.parse(e.data);if(null!=n){var o=n.response,i="ok"===n.result;if(!i&&null!=n.result,"auth"==o)return i&&(d=!0),m(t.Authentication,i);var u=n.request_id;if(null!=u){var r=c[u];null!=r&&setTimeout(function(){r(n)},50)}m(t.Message,n)}}})},p=function(e,n){if(null==n)return null;var t=s++;return a[t]={type:e,handler:n},t},m=function(e){for(var n=[],t=1;t<arguments.length;++t)n.push(arguments[t]);for(var o in a){var i=a[o];i.type==e&&setTimeout(function(){i.handler.apply(null,n)},50)}},b=function(e){if(g){var t=null;return"object"==typeof e&&(t=n++,e.request_id=t,l.push(e)),v()?(l.forEach(function(e){r.send(JSON.stringify(e))}),l=[]):h(),t}};return{isOpen:v,isSupport:g,hasAuthenticated:function(){return g?d:!1},onOpen:function(e){return p(t.Open,e)},onClose:function(e){return p(t.Close,e)},onAuthenticationResult:function(e){return g?p(t.Authentication,e):void 0},onMessage:function(e){return g?p(t.Message,e):void 0},unregister:function(e){delete a[e]},keepAlive:function(){if(g)if(v()){var n=Date.now();n-f>=e&&(b({cmd:"heartbeat"}),f=n)}else h()},send:function(e){g&&b(e)},request:function(e,n){if(g){var t=b(e);return null==t||null==n?t:void(c[t]=n)}},hasNewMsg:function(e,n){if(g&&u.hasAccessToken()){var t=JSON.parse(localStorage.getItem("LastPersonalMsg"))||{},i=t.key||0,r=t.time||0;if(0==i||e){var s=Date.now().toString(),a={key:i,time:r};if(3e4>s-r&&!e)return a.time=s,void localStorage.setItem("LastPersonalMsg",JSON.stringify(a));var l=0,f=b({cmd:"latest_conversations",page:1,size:20});c[f]=function(e){for(var t=e.conversations,i=document.querySelector("#footer_personal i"),u=0;u<t.length;u++)"read"!=t[u].status&&l++;null!=i&&0!=l&&i.classList.add("fb-badge1"),a.key=l,a.time=s,localStorage.setItem("LastPersonalMsg",JSON.stringify(a)),null!=n&&o.call(n,l)}}}},alertNotSupport:function(e){g||o.showAlert("您的系统版本不支持这个功能(Android系统版本至少为4.3)",function(){o.call(e)})}}}()},12:function(e,n,t){t(2),e.exports=function(e,n){t.e(6,function(o){o?n():e(t(15))})}},16:function(e,n,t){t(2),e.exports=function(e,n){t.e(9,function(o){o?n():e(t(29))})}}});